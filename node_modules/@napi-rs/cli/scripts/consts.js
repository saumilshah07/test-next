"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getNapiConfig = void 0;
const path_1 = require("path");
const parse_triple_1 = require("./parse-triple");
function getNapiConfig(packageJson = 'package.json', cwd = process.cwd()) {
    var _a, _b, _c, _d;
    const packageJsonPath = path_1.join(cwd, packageJson);
    const pkgJson = require(packageJsonPath);
    const { version: packageVersion, napi, name } = pkgJson;
    const additionPlatforms = ((_b = (_a = napi === null || napi === void 0 ? void 0 : napi.triples) === null || _a === void 0 ? void 0 : _a.additional) !== null && _b !== void 0 ? _b : []).map(parse_triple_1.parseTriple);
    const defaultPlatforms = ((_c = napi === null || napi === void 0 ? void 0 : napi.triples) === null || _c === void 0 ? void 0 : _c.defaults) === false ? [] : [...parse_triple_1.DefaultPlatforms];
    const platforms = [...defaultPlatforms, ...additionPlatforms];
    const releaseVersion = process.env.RELEASE_VERSION;
    const releaseVersionWithoutPrefix = (releaseVersion === null || releaseVersion === void 0 ? void 0 : releaseVersion.startsWith('v'))
        ? releaseVersion.substr(1)
        : releaseVersion;
    const version = releaseVersionWithoutPrefix !== null && releaseVersionWithoutPrefix !== void 0 ? releaseVersionWithoutPrefix : packageVersion;
    const packageName = name;
    const binaryName = (_d = napi === null || napi === void 0 ? void 0 : napi.name) !== null && _d !== void 0 ? _d : 'index';
    return {
        platforms,
        version,
        packageName,
        binaryName,
        packageJsonPath,
        content: pkgJson,
    };
}
exports.getNapiConfig = getNapiConfig;
//# sourceMappingURL=consts.js.map