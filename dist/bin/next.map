{"version":3,"sources":["../../bin/next.ts"],"sourcesContent":["#!/usr/bin/env node\nimport * as log from '../build/output/log'\nimport arg from 'next/dist/compiled/arg/index.js'\nimport { NON_STANDARD_NODE_ENV } from '../lib/constants'\n;['react', 'react-dom'].forEach((dependency) => {\n  try {\n    // When 'npm link' is used it checks the clone location. Not the project.\n    require.resolve(dependency)\n  } catch (err) {\n    console.warn(\n      `The module '${dependency}' was not found. Next.js requires that you include it in 'dependencies' of your 'package.json'. To add it, run 'npm install ${dependency}'`\n    )\n  }\n})\n\nconst defaultCommand = 'dev'\nexport type cliCommand = (argv?: string[]) => void\nconst commands: { [command: string]: () => Promise<cliCommand> } = {\n  build: () => import('../cli/next-build').then((i) => i.nextBuild),\n  start: () => import('../cli/next-start').then((i) => i.nextStart),\n  export: () => import('../cli/next-export').then((i) => i.nextExport),\n  dev: () => import('../cli/next-dev').then((i) => i.nextDev),\n  lint: () => import('../cli/next-lint').then((i) => i.nextLint),\n  telemetry: () => import('../cli/next-telemetry').then((i) => i.nextTelemetry),\n}\n\nconst args = arg(\n  {\n    // Types\n    '--version': Boolean,\n    '--help': Boolean,\n    '--inspect': Boolean,\n\n    // Aliases\n    '-v': '--version',\n    '-h': '--help',\n  },\n  {\n    permissive: true,\n  }\n)\n\n// Version is inlined into the file using taskr build pipeline\nif (args['--version']) {\n  console.log(`Next.js v${process.env.__NEXT_VERSION}`)\n  process.exit(0)\n}\n\n// Check if we are running `next <subcommand>` or `next`\nconst foundCommand = Boolean(commands[args._[0]])\n\n// Makes sure the `next --help` case is covered\n// This help message is only showed for `next --help`\n// `next <subcommand> --help` falls through to be handled later\nif (!foundCommand && args['--help']) {\n  console.log(`\n    Usage\n      $ next <command>\n\n    Available commands\n      ${Object.keys(commands).join(', ')}\n\n    Options\n      --version, -v   Version number\n      --help, -h      Displays this message\n\n    For more information run a command with the --help flag\n      $ next build --help\n  `)\n  process.exit(0)\n}\n\nconst command = foundCommand ? args._[0] : defaultCommand\nconst forwardedArgs = foundCommand ? args._.slice(1) : args._\n\nif (args['--inspect'])\n  throw new Error(\n    `--inspect flag is deprecated. Use env variable NODE_OPTIONS instead: NODE_OPTIONS='--inspect' next ${command}`\n  )\n\n// Make sure the `next <subcommand> --help` case is covered\nif (args['--help']) {\n  forwardedArgs.push('--help')\n}\n\nconst defaultEnv = command === 'dev' ? 'development' : 'production'\n\nconst standardEnv = ['production', 'development', 'test']\n\nif (process.env.NODE_ENV && !standardEnv.includes(process.env.NODE_ENV)) {\n  log.warn(NON_STANDARD_NODE_ENV)\n}\n\n;(process.env as any).NODE_ENV = process.env.NODE_ENV || defaultEnv\n\n// Make sure commands gracefully respect termination signals (e.g. from Docker)\nprocess.on('SIGTERM', () => process.exit(0))\nprocess.on('SIGINT', () => process.exit(0))\n\ncommands[command]()\n  .then((exec) => exec(forwardedArgs))\n  .then(() => {\n    if (command === 'build') {\n      // ensure process exits after build completes so open handles/connections\n      // don't cause process to hang\n      process.exit(0)\n    }\n  })\n\nif (command === 'dev') {\n  const { CONFIG_FILE } = require('../shared/lib/constants')\n  const { watchFile } = require('fs')\n  watchFile(`${process.cwd()}/${CONFIG_FILE}`, (cur: any, prev: any) => {\n    if (cur.size > 0 || prev.size > 0) {\n      console.log(\n        `\\n> Found a change in ${CONFIG_FILE}. Restart the server to see the changes in effect.`\n      )\n    }\n  })\n}\n"],"names":["log","forEach","dependency","require","resolve","err","console","warn","defaultCommand","commands","build","then","i","nextBuild","start","nextStart","export","nextExport","dev","nextDev","lint","nextLint","telemetry","nextTelemetry","args","Boolean","permissive","process","env","__NEXT_VERSION","exit","foundCommand","_","Object","keys","join","command","forwardedArgs","slice","Error","push","defaultEnv","standardEnv","NODE_ENV","includes","on","exec","CONFIG_FILE","watchFile","cwd","cur","prev","size"],"mappings":"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"}