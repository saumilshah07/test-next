{"version":3,"sources":["../../../lib/typescript/diagnosticFormatter.ts"],"sourcesContent":["import { codeFrameColumns } from 'next/dist/compiled/babel/code-frame'\nimport chalk from 'chalk'\nimport path from 'path'\n\n// eslint typescript has a bug with TS enums\n/* eslint-disable no-shadow */\nexport enum DiagnosticCategory {\n  Warning = 0,\n  Error = 1,\n  Suggestion = 2,\n  Message = 3,\n}\n\nexport async function getFormattedDiagnostic(\n  ts: typeof import('typescript'),\n  baseDir: string,\n  diagnostic: import('typescript').Diagnostic\n): Promise<string> {\n  let message = ''\n\n  const reason = ts.flattenDiagnosticMessageText(diagnostic.messageText, '\\n')\n  const category = diagnostic.category\n  switch (category) {\n    // Warning\n    case DiagnosticCategory.Warning: {\n      message += chalk.yellow.bold('Type warning') + ': '\n      break\n    }\n    // Error\n    case DiagnosticCategory.Error: {\n      message += chalk.red.bold('Type error') + ': '\n      break\n    }\n    // 2 = Suggestion, 3 = Message\n    case DiagnosticCategory.Suggestion:\n    case DiagnosticCategory.Message:\n    default: {\n      message += chalk.cyan.bold(category === 2 ? 'Suggestion' : 'Info') + ': '\n      break\n    }\n  }\n  message += reason + '\\n'\n\n  if (diagnostic.file) {\n    const pos = diagnostic.file.getLineAndCharacterOfPosition(diagnostic.start!)\n    const line = pos.line + 1\n    const character = pos.character + 1\n\n    let fileName = path.posix.normalize(\n      path.relative(baseDir, diagnostic.file.fileName).replace(/\\\\/g, '/')\n    )\n    if (!fileName.startsWith('.')) {\n      fileName = './' + fileName\n    }\n\n    message =\n      chalk.cyan(fileName) +\n      ':' +\n      chalk.yellow(line.toString()) +\n      ':' +\n      chalk.yellow(character.toString()) +\n      '\\n' +\n      message\n\n    message +=\n      '\\n' +\n      codeFrameColumns(\n        diagnostic.file.getFullText(diagnostic.file.getSourceFile()),\n        {\n          start: { line: line, column: character },\n        },\n        { forceColor: true }\n      )\n  }\n\n  return message\n}\n"],"names":["getFormattedDiagnostic","ts","baseDir","diagnostic","message","reason","flattenDiagnosticMessageText","messageText","category","DiagnosticCategory","Warning","yellow","bold","Error","red","Suggestion","Message","cyan","file","pos","getLineAndCharacterOfPosition","start","line","character","fileName","posix","normalize","relative","replace","startsWith","toString","getFullText","getSourceFile","column","forceColor"],"mappings":"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"}