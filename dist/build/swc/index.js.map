{"version":3,"sources":["../../../build/swc/index.js"],"sourcesContent":["const { loadBinding } = require('@node-rs/helper')\nconst path = require('path')\n\n/**\n * __dirname means load native addon from current dir\n * 'next-swc' is the name of native addon\n * the second arguments was decided by `napi.name` field in `package.json`\n * the third arguments was decided by `name` field in `package.json`\n * `loadBinding` helper will load `next-swc.[PLATFORM].node` from `__dirname` first\n * If failed to load addon, it will fallback to load from `next-swc-[PLATFORM]`\n */\nconst bindings = loadBinding(\n  path.join(__dirname, '../../../native'),\n  'next-swc',\n  '@next/swc'\n)\n\nasync function transform(src, options) {\n  const isModule = typeof src !== 'string'\n  options = options || {}\n\n  if (options?.jsc?.parser) {\n    options.jsc.parser.syntax = options.jsc.parser.syntax ?? 'ecmascript'\n  }\n\n  const { plugin, ...newOptions } = options\n\n  if (plugin) {\n    const m =\n      typeof src === 'string'\n        ? await this.parse(src, options?.jsc?.parser)\n        : src\n    return this.transform(plugin(m), newOptions)\n  }\n\n  return bindings.transform(\n    isModule ? JSON.stringify(src) : src,\n    isModule,\n    toBuffer(newOptions)\n  )\n}\n\nfunction transformSync(src, options) {\n  const isModule = typeof src !== 'string'\n  options = options || {}\n\n  if (options?.jsc?.parser) {\n    options.jsc.parser.syntax = options.jsc.parser.syntax ?? 'ecmascript'\n  }\n\n  const { plugin, ...newOptions } = options\n\n  if (plugin) {\n    const m =\n      typeof src === 'string' ? this.parseSync(src, options?.jsc?.parser) : src\n    return this.transformSync(plugin(m), newOptions)\n  }\n\n  return bindings.transformSync(\n    isModule ? JSON.stringify(src) : src,\n    isModule,\n    toBuffer(newOptions)\n  )\n}\n\nfunction toBuffer(t) {\n  return Buffer.from(JSON.stringify(t))\n}\n\nmodule.exports.transform = transform\nmodule.exports.transformSync = transformSync\n"],"names":["loadBinding","require","path","bindings","join","__dirname","transform","src","options","isModule","jsc","parser","syntax","plugin","newOptions","m","parse","JSON","stringify","toBuffer","transformSync","parseSync","t","Buffer","from","module","exports"],"mappings":"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"}