{"version":3,"sources":["../../../../../build/webpack/loaders/next-serverless-loader/utils.ts"],"sourcesContent":["import { IncomingMessage, ServerResponse } from 'http'\nimport { format as formatUrl, UrlWithParsedQuery, parse as parseUrl } from 'url'\nimport { parse as parseQs, ParsedUrlQuery } from 'querystring'\nimport { Rewrite } from '../../../../lib/load-custom-routes'\nimport { normalizeLocalePath } from '../../../../shared/lib/i18n/normalize-locale-path'\nimport pathMatch from '../../../../shared/lib/router/utils/path-match'\nimport { getRouteRegex } from '../../../../shared/lib/router/utils/route-regex'\nimport { getRouteMatcher } from '../../../../shared/lib/router/utils/route-matcher'\nimport prepareDestination, {\n  matchHas,\n} from '../../../../shared/lib/router/utils/prepare-destination'\nimport { __ApiPreviewProps } from '../../../../server/api-utils'\nimport { BuildManifest } from '../../../../server/get-page-files'\nimport {\n  GetServerSideProps,\n  GetStaticPaths,\n  GetStaticProps,\n} from '../../../../types'\nimport accept from '@hapi/accept'\nimport { detectLocaleCookie } from '../../../../shared/lib/i18n/detect-locale-cookie'\nimport { detectDomainLocale } from '../../../../shared/lib/i18n/detect-domain-locale'\nimport { denormalizePagePath } from '../../../../server/denormalize-page-path'\nimport cookie from 'next/dist/compiled/cookie'\nimport { TEMPORARY_REDIRECT_STATUS } from '../../../../shared/lib/constants'\nimport { NextConfig } from '../../../../server/config'\n\nconst getCustomRouteMatcher = pathMatch(true)\n\nexport const vercelHeader = 'x-vercel-id'\n\nexport type ServerlessHandlerCtx = {\n  page: string\n\n  pageModule: any\n  pageComponent?: any\n  pageConfig?: any\n  pageGetStaticProps?: GetStaticProps\n  pageGetStaticPaths?: GetStaticPaths\n  pageGetServerSideProps?: GetServerSideProps\n\n  appModule?: any\n  errorModule?: any\n  documentModule?: any\n  notFoundModule?: any\n\n  runtimeConfig: any\n  buildManifest?: BuildManifest\n  reactLoadableManifest?: any\n  basePath: string\n  rewrites: Rewrite[]\n  pageIsDynamic: boolean\n  generateEtags: boolean\n  distDir: string\n  buildId: string\n  escapedBuildId: string\n  assetPrefix: string\n  poweredByHeader: boolean\n  canonicalBase: string\n  encodedPreviewProps: __ApiPreviewProps\n  i18n?: NextConfig['i18n']\n}\n\nexport function getUtils({\n  page,\n  i18n,\n  basePath,\n  rewrites,\n  pageIsDynamic,\n}: {\n  page: ServerlessHandlerCtx['page']\n  i18n?: ServerlessHandlerCtx['i18n']\n  basePath: ServerlessHandlerCtx['basePath']\n  rewrites: ServerlessHandlerCtx['rewrites']\n  pageIsDynamic: ServerlessHandlerCtx['pageIsDynamic']\n}) {\n  let defaultRouteRegex: ReturnType<typeof getRouteRegex> | undefined\n  let dynamicRouteMatcher: ReturnType<typeof getRouteMatcher> | undefined\n  let defaultRouteMatches: ParsedUrlQuery | undefined\n\n  if (pageIsDynamic) {\n    defaultRouteRegex = getRouteRegex(page)\n    dynamicRouteMatcher = getRouteMatcher(defaultRouteRegex)\n    defaultRouteMatches = dynamicRouteMatcher(page) as ParsedUrlQuery\n  }\n\n  function handleRewrites(req: IncomingMessage, parsedUrl: UrlWithParsedQuery) {\n    for (const rewrite of rewrites) {\n      const matcher = getCustomRouteMatcher(rewrite.source)\n      let params = matcher(parsedUrl.pathname)\n\n      if (rewrite.has && params) {\n        const hasParams = matchHas(req, rewrite.has, parsedUrl.query)\n\n        if (hasParams) {\n          Object.assign(params, hasParams)\n        } else {\n          params = false\n        }\n      }\n\n      if (params) {\n        const { parsedDestination } = prepareDestination(\n          rewrite.destination,\n          params,\n          parsedUrl.query,\n          true\n        )\n\n        Object.assign(parsedUrl.query, parsedDestination.query)\n        delete (parsedDestination as any).query\n\n        Object.assign(parsedUrl, parsedDestination)\n\n        let fsPathname = parsedUrl.pathname\n\n        if (basePath) {\n          fsPathname =\n            fsPathname!.replace(new RegExp(`^${basePath}`), '') || '/'\n        }\n\n        if (i18n) {\n          const destLocalePathResult = normalizeLocalePath(\n            fsPathname!,\n            i18n.locales\n          )\n          fsPathname = destLocalePathResult.pathname\n          parsedUrl.query.nextInternalLocale =\n            destLocalePathResult.detectedLocale || params.nextInternalLocale\n        }\n\n        if (fsPathname === page) {\n          break\n        }\n\n        if (pageIsDynamic && dynamicRouteMatcher) {\n          const dynamicParams = dynamicRouteMatcher(fsPathname)\n          if (dynamicParams) {\n            parsedUrl.query = {\n              ...parsedUrl.query,\n              ...dynamicParams,\n            }\n            break\n          }\n        }\n      }\n    }\n\n    return parsedUrl\n  }\n\n  function handleBasePath(req: IncomingMessage, parsedUrl: UrlWithParsedQuery) {\n    // always strip the basePath if configured since it is required\n    req.url = req.url!.replace(new RegExp(`^${basePath}`), '') || '/'\n    parsedUrl.pathname =\n      parsedUrl.pathname!.replace(new RegExp(`^${basePath}`), '') || '/'\n  }\n\n  function getParamsFromRouteMatches(\n    req: IncomingMessage,\n    renderOpts?: any,\n    detectedLocale?: string\n  ) {\n    return getRouteMatcher(\n      (function () {\n        const { groups, routeKeys } = defaultRouteRegex!\n\n        return {\n          re: {\n            // Simulate a RegExp match from the \\`req.url\\` input\n            exec: (str: string) => {\n              const obj = parseQs(str)\n\n              // favor named matches if available\n              const routeKeyNames = Object.keys(routeKeys || {})\n\n              const filterLocaleItem = (val: string | string[]) => {\n                if (i18n) {\n                  // locale items can be included in route-matches\n                  // for fallback SSG pages so ensure they are\n                  // filtered\n                  const isCatchAll = Array.isArray(val)\n                  const _val = isCatchAll ? val[0] : val\n\n                  if (\n                    typeof _val === 'string' &&\n                    i18n.locales.some((item) => {\n                      if (item.toLowerCase() === _val.toLowerCase()) {\n                        detectedLocale = item\n                        renderOpts.locale = detectedLocale\n                        return true\n                      }\n                      return false\n                    })\n                  ) {\n                    // remove the locale item from the match\n                    if (isCatchAll) {\n                      ;(val as string[]).splice(0, 1)\n                    }\n\n                    // the value is only a locale item and\n                    // shouldn't be added\n                    return isCatchAll ? val.length === 0 : true\n                  }\n                }\n                return false\n              }\n\n              if (routeKeyNames.every((name) => obj[name])) {\n                return routeKeyNames.reduce((prev, keyName) => {\n                  const paramName = routeKeys?.[keyName]\n\n                  if (paramName && !filterLocaleItem(obj[keyName])) {\n                    prev[groups[paramName].pos] = obj[keyName]\n                  }\n                  return prev\n                }, {} as any)\n              }\n\n              return Object.keys(obj).reduce((prev, key) => {\n                if (!filterLocaleItem(obj[key])) {\n                  return Object.assign(prev, {\n                    [key]: obj[key],\n                  })\n                }\n                return prev\n              }, {})\n            },\n          },\n          groups,\n        }\n      })() as any\n    )(req.headers['x-now-route-matches'] as string) as ParsedUrlQuery\n  }\n\n  function interpolateDynamicPath(pathname: string, params: ParsedUrlQuery) {\n    if (!defaultRouteRegex) return pathname\n\n    for (const param of Object.keys(defaultRouteRegex.groups)) {\n      const { optional, repeat } = defaultRouteRegex.groups[param]\n      let builtParam = `[${repeat ? '...' : ''}${param}]`\n\n      if (optional) {\n        builtParam = `[${builtParam}]`\n      }\n\n      const paramIdx = pathname!.indexOf(builtParam)\n\n      if (paramIdx > -1) {\n        let paramValue: string\n\n        if (Array.isArray(params[param])) {\n          paramValue = (params[param] as string[])\n            .map((v) => v && encodeURIComponent(v))\n            .join('/')\n        } else {\n          paramValue =\n            params[param] && encodeURIComponent(params[param] as string)\n        }\n\n        pathname =\n          pathname.substr(0, paramIdx) +\n          (paramValue || '') +\n          pathname.substr(paramIdx + builtParam.length)\n      }\n    }\n\n    return pathname\n  }\n\n  function normalizeVercelUrl(req: IncomingMessage, trustQuery: boolean) {\n    // make sure to normalize req.url on Vercel to strip dynamic params\n    // from the query which are added during routing\n    if (pageIsDynamic && trustQuery && defaultRouteRegex) {\n      const _parsedUrl = parseUrl(req.url!, true)\n      delete (_parsedUrl as any).search\n\n      for (const param of Object.keys(defaultRouteRegex.groups)) {\n        delete _parsedUrl.query[param]\n      }\n      req.url = formatUrl(_parsedUrl)\n    }\n  }\n\n  function normalizeDynamicRouteParams(params: ParsedUrlQuery) {\n    let hasValidParams = true\n    if (!defaultRouteRegex) return { params, hasValidParams: false }\n\n    params = Object.keys(defaultRouteRegex.groups).reduce((prev, key) => {\n      let value: string | string[] | undefined = params[key]\n\n      // if the value matches the default value we can't rely\n      // on the parsed params, this is used to signal if we need\n      // to parse x-now-route-matches or not\n      const defaultValue = defaultRouteMatches![key]\n\n      const isDefaultValue = Array.isArray(defaultValue)\n        ? defaultValue.some((defaultVal) => {\n            return Array.isArray(value)\n              ? value.some((val) => val.includes(defaultVal))\n              : value?.includes(defaultVal)\n          })\n        : value?.includes(defaultValue as string)\n\n      if (isDefaultValue || typeof value === 'undefined') {\n        hasValidParams = false\n      }\n\n      // non-provided optional values should be undefined so normalize\n      // them to undefined\n      if (\n        defaultRouteRegex!.groups[key].optional &&\n        (!value ||\n          (Array.isArray(value) &&\n            value.length === 1 &&\n            // fallback optional catch-all SSG pages have\n            // [[...paramName]] for the root path on Vercel\n            (value[0] === 'index' || value[0] === `[[...${key}]]`)))\n      ) {\n        value = undefined\n        delete params[key]\n      }\n\n      // query values from the proxy aren't already split into arrays\n      // so make sure to normalize catch-all values\n      if (\n        value &&\n        typeof value === 'string' &&\n        defaultRouteRegex!.groups[key].repeat\n      ) {\n        value = value.split('/')\n      }\n\n      if (value) {\n        prev[key] = value\n      }\n      return prev\n    }, {} as ParsedUrlQuery)\n\n    return {\n      params,\n      hasValidParams,\n    }\n  }\n\n  function handleLocale(\n    req: IncomingMessage,\n    res: ServerResponse,\n    parsedUrl: UrlWithParsedQuery,\n    routeNoAssetPath: string,\n    shouldNotRedirect: boolean\n  ) {\n    if (!i18n) return\n    const pathname = parsedUrl.pathname || '/'\n\n    let defaultLocale = i18n.defaultLocale\n    let detectedLocale = detectLocaleCookie(req, i18n.locales)\n    let acceptPreferredLocale\n    try {\n      acceptPreferredLocale =\n        i18n.localeDetection !== false\n          ? accept.language(req.headers['accept-language'], i18n.locales)\n          : detectedLocale\n    } catch (_) {\n      acceptPreferredLocale = detectedLocale\n    }\n\n    const { host } = req.headers || {}\n    // remove port from host and remove port if present\n    const hostname = host && host.split(':')[0].toLowerCase()\n\n    const detectedDomain = detectDomainLocale(i18n.domains, hostname)\n    if (detectedDomain) {\n      defaultLocale = detectedDomain.defaultLocale\n      detectedLocale = defaultLocale\n      ;(req as any).__nextIsLocaleDomain = true\n    }\n\n    // if not domain specific locale use accept-language preferred\n    detectedLocale = detectedLocale || acceptPreferredLocale\n\n    let localeDomainRedirect\n    const localePathResult = normalizeLocalePath(pathname, i18n.locales)\n\n    routeNoAssetPath = normalizeLocalePath(\n      routeNoAssetPath,\n      i18n.locales\n    ).pathname\n\n    if (localePathResult.detectedLocale) {\n      detectedLocale = localePathResult.detectedLocale\n      req.url = formatUrl({\n        ...parsedUrl,\n        pathname: localePathResult.pathname,\n      })\n      ;(req as any).__nextStrippedLocale = true\n      parsedUrl.pathname = localePathResult.pathname\n    }\n\n    // If a detected locale is a domain specific locale and we aren't already\n    // on that domain and path prefix redirect to it to prevent duplicate\n    // content from multiple domains\n    if (detectedDomain) {\n      const localeToCheck = localePathResult.detectedLocale\n        ? detectedLocale\n        : acceptPreferredLocale\n\n      const matchedDomain = detectDomainLocale(\n        i18n.domains,\n        undefined,\n        localeToCheck\n      )\n\n      if (matchedDomain && matchedDomain.domain !== detectedDomain.domain) {\n        localeDomainRedirect = `http${matchedDomain.http ? '' : 's'}://${\n          matchedDomain.domain\n        }/${localeToCheck === matchedDomain.defaultLocale ? '' : localeToCheck}`\n      }\n    }\n\n    const denormalizedPagePath = denormalizePagePath(pathname)\n    const detectedDefaultLocale =\n      !detectedLocale ||\n      detectedLocale.toLowerCase() === defaultLocale.toLowerCase()\n    const shouldStripDefaultLocale = false\n    // detectedDefaultLocale &&\n    // denormalizedPagePath.toLowerCase() === \\`/\\${i18n.defaultLocale.toLowerCase()}\\`\n\n    const shouldAddLocalePrefix =\n      !detectedDefaultLocale && denormalizedPagePath === '/'\n\n    detectedLocale = detectedLocale || i18n.defaultLocale\n\n    if (\n      !shouldNotRedirect &&\n      !req.headers[vercelHeader] &&\n      i18n.localeDetection !== false &&\n      (localeDomainRedirect ||\n        shouldAddLocalePrefix ||\n        shouldStripDefaultLocale)\n    ) {\n      // set the NEXT_LOCALE cookie when a user visits the default locale\n      // with the locale prefix so that they aren't redirected back to\n      // their accept-language preferred locale\n      if (shouldStripDefaultLocale && acceptPreferredLocale !== defaultLocale) {\n        const previous = res.getHeader('set-cookie')\n\n        res.setHeader('set-cookie', [\n          ...(typeof previous === 'string'\n            ? [previous]\n            : Array.isArray(previous)\n            ? previous\n            : []),\n          cookie.serialize('NEXT_LOCALE', defaultLocale, {\n            httpOnly: true,\n            path: '/',\n          }),\n        ])\n      }\n\n      res.setHeader(\n        'Location',\n        formatUrl({\n          // make sure to include any query values when redirecting\n          ...parsedUrl,\n          pathname: localeDomainRedirect\n            ? localeDomainRedirect\n            : shouldStripDefaultLocale\n            ? basePath || '/'\n            : `${basePath}/${detectedLocale}`,\n        })\n      )\n      res.statusCode = TEMPORARY_REDIRECT_STATUS\n      res.end()\n      return\n    }\n\n    detectedLocale =\n      localePathResult.detectedLocale ||\n      (detectedDomain && detectedDomain.defaultLocale) ||\n      defaultLocale\n\n    return {\n      defaultLocale,\n      detectedLocale,\n      routeNoAssetPath,\n    }\n  }\n\n  return {\n    handleLocale,\n    handleRewrites,\n    handleBasePath,\n    defaultRouteRegex,\n    normalizeVercelUrl,\n    dynamicRouteMatcher,\n    defaultRouteMatches,\n    interpolateDynamicPath,\n    getParamsFromRouteMatches,\n    normalizeDynamicRouteParams,\n  }\n}\n"],"names":["getUtils","getCustomRouteMatcher","vercelHeader","page","i18n","basePath","rewrites","pageIsDynamic","defaultRouteRegex","dynamicRouteMatcher","defaultRouteMatches","handleRewrites","req","parsedUrl","rewrite","matcher","source","params","pathname","has","hasParams","query","Object","assign","parsedDestination","destination","fsPathname","replace","RegExp","destLocalePathResult","locales","nextInternalLocale","detectedLocale","dynamicParams","handleBasePath","url","getParamsFromRouteMatches","renderOpts","groups","routeKeys","re","exec","str","obj","routeKeyNames","keys","filterLocaleItem","val","isCatchAll","Array","isArray","_val","some","item","toLowerCase","locale","splice","length","every","name","reduce","prev","keyName","paramName","pos","key","headers","interpolateDynamicPath","param","optional","repeat","builtParam","paramIdx","indexOf","paramValue","map","v","encodeURIComponent","join","substr","normalizeVercelUrl","trustQuery","_parsedUrl","search","normalizeDynamicRouteParams","hasValidParams","value","defaultValue","isDefaultValue","defaultVal","includes","undefined","split","handleLocale","res","routeNoAssetPath","shouldNotRedirect","defaultLocale","acceptPreferredLocale","localeDetection","language","_","host","hostname","detectedDomain","domains","__nextIsLocaleDomain","localeDomainRedirect","localePathResult","__nextStrippedLocale","localeToCheck","matchedDomain","domain","http","denormalizedPagePath","detectedDefaultLocale","shouldStripDefaultLocale","shouldAddLocalePrefix","previous","getHeader","setHeader","serialize","httpOnly","path","statusCode","end"],"mappings":"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"}