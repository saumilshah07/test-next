{"version":3,"sources":["../../../../../build/webpack/config/blocks/base.ts"],"sourcesContent":["import isWslBoolean from 'next/dist/compiled/is-wsl'\nimport curry from 'next/dist/compiled/lodash.curry'\nimport { webpack, isWebpack5 } from 'next/dist/compiled/webpack/webpack'\nimport { ConfigurationContext } from '../utils'\n\nconst isWindows = process.platform === 'win32' || isWslBoolean\n\nexport const base = curry(function base(\n  ctx: ConfigurationContext,\n  config: webpack.Configuration\n) {\n  config.mode = ctx.isDevelopment ? 'development' : 'production'\n  config.name = ctx.isServer ? 'server' : 'client'\n  if (isWebpack5) {\n    // @ts-ignore TODO webpack 5 typings\n    config.target = ctx.isServer ? 'node12.17' : ['web', 'es5']\n  } else {\n    config.target = ctx.isServer ? 'node' : 'web'\n  }\n\n  // Stop compilation early in a production build when an error is encountered.\n  // This behavior isn't desirable in development due to how the HMR system\n  // works, but is a good default for production.\n  config.bail = ctx.isProduction\n\n  // https://webpack.js.org/configuration/devtool/#development\n  if (ctx.isDevelopment) {\n    if (process.env.__NEXT_TEST_MODE && !process.env.__NEXT_TEST_WITH_DEVTOOL) {\n      config.devtool = false\n    } else if (isWindows) {\n      // Non-eval based source maps are slow to rebuild, so we only enable\n      // them for Windows. Unfortunately, eval source maps are flagged as\n      // suspicious by Windows Defender and block HMR.\n      config.devtool = 'inline-source-map'\n    } else {\n      // `eval-source-map` provides full-fidelity source maps for the\n      // original source, including columns and original variable names.\n      // This is desirable so the in-browser debugger can correctly pause\n      // and show scoped variables with their original names.\n      config.devtool = 'eval-source-map'\n    }\n  } else {\n    // Enable browser sourcemaps:\n    if (ctx.productionBrowserSourceMaps && ctx.isClient) {\n      config.devtool = 'source-map'\n    } else {\n      config.devtool = false\n    }\n  }\n\n  if (!config.module) {\n    config.module = { rules: [] }\n  }\n\n  // TODO: add codemod for \"Should not import the named export\" with JSON files\n  config.module.strictExportPresence = !isWebpack5\n\n  return config\n})\n"],"names":["isWindows","process","platform","base","ctx","config","mode","isDevelopment","name","isServer","target","bail","isProduction","env","__NEXT_TEST_MODE","__NEXT_TEST_WITH_DEVTOOL","devtool","productionBrowserSourceMaps","isClient","module","rules","strictExportPresence"],"mappings":";;;;;AAAyB,GAA2B,CAA3B,MAA2B;AAClC,GAAiC,CAAjC,YAAiC;AACf,GAAoC,CAApC,QAAoC;;;;;;AAGxE,KAAK,CAACA,SAAS,GAAGC,OAAO,CAACC,QAAQ,KAAK,CAAO,UALrB,MAA2B;AAO7C,KAAK,CAACC,IAAI,OANC,YAAiC,UAMzB,QAAQ,CAACA,IAAI,CACrCC,GAAyB,EACzBC,MAA6B,EAC7B,CAAC;IACDA,MAAM,CAACC,IAAI,GAAGF,GAAG,CAACG,aAAa,GAAG,CAAa,eAAG,CAAY;IAC9DF,MAAM,CAACG,IAAI,GAAGJ,GAAG,CAACK,QAAQ,GAAG,CAAQ,UAAG,CAAQ;IAChD,EAAE,EAXgC,QAAoC,aAWtD,CAAC;QACf,EAAoC,AAApC,kCAAoC;QACpCJ,MAAM,CAACK,MAAM,GAAGN,GAAG,CAACK,QAAQ,GAAG,CAAW,aAAG,CAAC;YAAA,CAAK;YAAE,CAAK;QAAA,CAAC;IAC7D,CAAC,MAAM,CAAC;QACNJ,MAAM,CAACK,MAAM,GAAGN,GAAG,CAACK,QAAQ,GAAG,CAAM,QAAG,CAAK;IAC/C,CAAC;IAED,EAA6E,AAA7E,2EAA6E;IAC7E,EAAyE,AAAzE,uEAAyE;IACzE,EAA+C,AAA/C,6CAA+C;IAC/CJ,MAAM,CAACM,IAAI,GAAGP,GAAG,CAACQ,YAAY;IAE9B,EAA4D,AAA5D,0DAA4D;IAC5D,EAAE,EAAER,GAAG,CAACG,aAAa,EAAE,CAAC;QACtB,EAAE,EAAEN,OAAO,CAACY,GAAG,CAACC,gBAAgB,KAAKb,OAAO,CAACY,GAAG,CAACE,wBAAwB,EAAE,CAAC;YAC1EV,MAAM,CAACW,OAAO,GAAG,KAAK;QACxB,CAAC,MAAM,EAAE,EAAEhB,SAAS,EAAE,CAAC;YACrB,EAAoE,AAApE,kEAAoE;YACpE,EAAmE,AAAnE,iEAAmE;YACnE,EAAgD,AAAhD,8CAAgD;YAChDK,MAAM,CAACW,OAAO,GAAG,CAAmB;QACtC,CAAC,MAAM,CAAC;YACN,EAA+D,AAA/D,6DAA+D;YAC/D,EAAkE,AAAlE,gEAAkE;YAClE,EAAmE,AAAnE,iEAAmE;YACnE,EAAuD,AAAvD,qDAAuD;YACvDX,MAAM,CAACW,OAAO,GAAG,CAAiB;QACpC,CAAC;IACH,CAAC,MAAM,CAAC;QACN,EAA6B,AAA7B,2BAA6B;QAC7B,EAAE,EAAEZ,GAAG,CAACa,2BAA2B,IAAIb,GAAG,CAACc,QAAQ,EAAE,CAAC;YACpDb,MAAM,CAACW,OAAO,GAAG,CAAY;QAC/B,CAAC,MAAM,CAAC;YACNX,MAAM,CAACW,OAAO,GAAG,KAAK;QACxB,CAAC;IACH,CAAC;IAED,EAAE,GAAGX,MAAM,CAACc,MAAM,EAAE,CAAC;QACnBd,MAAM,CAACc,MAAM,GAAG,CAAC;YAACC,KAAK,EAAE,CAAC,CAAC;QAAC,CAAC;IAC/B,CAAC;IAED,EAA6E,AAA7E,2EAA6E;IAC7Ef,MAAM,CAACc,MAAM,CAACE,oBAAoB,IArDA,QAAoC;IAuDtE,MAAM,CAAChB,MAAM;AACf,CAAC;QAnDYF,IAAI,GAAJA,IAAI"}