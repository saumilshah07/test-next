{"version":3,"sources":["../../../../../../build/webpack/plugins/webpack-conformance-plugin/checks/granular-chunks-conformance.ts"],"sourcesContent":["/* @eslint-disable no-redeclare */\nimport chalk from 'chalk'\nimport {\n  CONFORMANCE_ERROR_PREFIX,\n  CONFORMANCE_WARNING_PREFIX,\n} from '../constants'\nimport {\n  IConformanceTestResult,\n  IConformanceTestStatus,\n  IWebpackConformanceTest,\n} from '../TestInterface'\nimport { deepEqual } from '../utils/utils'\n\nfunction getWarningMessage(modifiedProp: string) {\n  return (\n    `${CONFORMANCE_WARNING_PREFIX}: The splitChunks config has been carefully ` +\n    `crafted to optimize build size and build times. Modifying - ${chalk.bold(\n      modifiedProp\n    )} could result in slower builds and increased code duplication`\n  )\n}\n\nfunction getErrorMessage(message: string) {\n  return (\n    `${CONFORMANCE_ERROR_PREFIX}: The splitChunks config has been carefully ` +\n    `crafted to optimize build size and build times. Please avoid changes to ${chalk.bold(\n      message\n    )}`\n  )\n}\n\n/* @eslint-disable-next-line no-redeclare */\nexport class GranularChunksConformanceCheck implements IWebpackConformanceTest {\n  granularChunksConfig: any\n  constructor(granularChunksConfig: any) {\n    this.granularChunksConfig = granularChunksConfig\n  }\n\n  public buildStared(options: any): IConformanceTestResult {\n    const userSplitChunks = options.optimization.splitChunks\n    const warnings = []\n    const errors = []\n\n    if (\n      userSplitChunks.maxInitialRequests !==\n      this.granularChunksConfig.maxInitialRequests\n    ) {\n      warnings.push('splitChunks.maxInitialRequests')\n    }\n\n    if (userSplitChunks.minSize !== this.granularChunksConfig.minSize) {\n      warnings.push('splitChunks.minSize')\n    }\n\n    const userCacheGroup = userSplitChunks.cacheGroups\n    const originalCacheGroup = this.granularChunksConfig.cacheGroups\n\n    if (userCacheGroup.vendors !== false) {\n      errors.push('splitChunks.cacheGroups.vendors')\n    }\n\n    if (!deepEqual(userCacheGroup.framework, originalCacheGroup.framework)) {\n      errors.push('splitChunks.cacheGroups.framework')\n    }\n\n    if (!deepEqual(userCacheGroup.lib, originalCacheGroup.lib)) {\n      errors.push('splitChunks.cacheGroups.lib')\n    }\n\n    if (!deepEqual(userCacheGroup.commons, originalCacheGroup.commons)) {\n      errors.push('splitChunks.cacheGroups.commons')\n    }\n\n    if (!deepEqual(userCacheGroup.shared, originalCacheGroup.shared)) {\n      errors.push('splitChunks.cacheGroups.shared')\n    }\n\n    if (!warnings.length && !errors.length) {\n      return {\n        result: IConformanceTestStatus.SUCCESS,\n      }\n    }\n\n    const failedResult: IConformanceTestResult = {\n      result: IConformanceTestStatus.FAILED,\n    }\n\n    if (warnings.length) {\n      failedResult.warnings = warnings.map((warning) => ({\n        message: getWarningMessage(warning),\n      }))\n    }\n\n    if (errors.length) {\n      failedResult.warnings = errors.map((error) => ({\n        message: getErrorMessage(error),\n      }))\n    }\n\n    return failedResult\n  }\n}\n"],"names":["getWarningMessage","modifiedProp","bold","getErrorMessage","message","GranularChunksConformanceCheck","granularChunksConfig","buildStared","options","userSplitChunks","optimization","splitChunks","warnings","errors","maxInitialRequests","push","minSize","userCacheGroup","cacheGroups","originalCacheGroup","vendors","framework","lib","commons","shared","length","result","SUCCESS","failedResult","FAILED","map","warning","error"],"mappings":"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"}