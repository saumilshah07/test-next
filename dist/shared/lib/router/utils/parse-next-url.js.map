{"version":3,"sources":["../../../../../shared/lib/router/utils/parse-next-url.ts"],"sourcesContent":["import { getCookieParser } from '../../../../server/api-utils'\nimport { getLocaleMetadata } from '../../i18n/get-locale-metadata'\nimport { parseUrl } from './parse-url'\nimport type { NextConfig, DomainLocale } from '../../../../server/config-shared'\nimport type { ParsedUrl } from './parse-url'\nimport type { PathLocale } from '../../i18n/normalize-locale-path'\n\ninterface Params {\n  headers?: { [key: string]: string | string[] | undefined }\n  nextConfig: NextConfig\n  url?: string\n}\n\nexport function parseNextUrl({ headers, nextConfig, url = '/' }: Params) {\n  const urlParsed: ParsedNextUrl = parseUrl(url)\n  const { basePath } = nextConfig\n\n  if (basePath && urlParsed.pathname.startsWith(basePath)) {\n    urlParsed.pathname = urlParsed.pathname.replace(basePath, '') || '/'\n    urlParsed.basePath = basePath\n  }\n\n  if (nextConfig.i18n) {\n    urlParsed.locale = getLocaleMetadata({\n      cookies: getCookieParser(headers || {}),\n      headers: headers,\n      nextConfig: {\n        basePath: nextConfig.basePath,\n        i18n: nextConfig.i18n,\n        trailingSlash: nextConfig.trailingSlash,\n      },\n      url: urlParsed,\n    })\n\n    if (urlParsed.locale?.path.detectedLocale) {\n      urlParsed.pathname = urlParsed.locale.path.pathname\n    }\n  }\n\n  return urlParsed\n}\n\nexport interface ParsedNextUrl extends ParsedUrl {\n  basePath?: string\n  locale?: {\n    defaultLocale: string\n    domain?: DomainLocale\n    locale: string\n    path: PathLocale\n    redirect?: string\n    trailingSlash?: boolean\n  }\n}\n"],"names":["parseNextUrl","headers","nextConfig","url","urlParsed","basePath","pathname","startsWith","replace","i18n","locale","cookies","trailingSlash","path","detectedLocale"],"mappings":";;;;QAagBA,YAAY,GAAZA,YAAY;AAbI,GAA8B,CAA9B,SAA8B;AAC5B,GAAgC,CAAhC,kBAAgC;AACzC,GAAa,CAAb,SAAa;SAWtBA,YAAY,CAAC,CAAC,CAACC,OAAO,GAAEC,UAAU,GAAEC,GAAG,EAAG,CAAG,IAAS,CAAC,EAAE,CAAC;IACxE,KAAK,CAACC,SAAS,OAZQ,SAAa,WAYMD,GAAG;IAC7C,KAAK,CAAC,CAAC,CAACE,QAAQ,EAAC,CAAC,GAAGH,UAAU;IAE/B,EAAE,EAAEG,QAAQ,IAAID,SAAS,CAACE,QAAQ,CAACC,UAAU,CAACF,QAAQ,GAAG,CAAC;QACxDD,SAAS,CAACE,QAAQ,GAAGF,SAAS,CAACE,QAAQ,CAACE,OAAO,CAACH,QAAQ,EAAE,CAAE,MAAK,CAAG;QACpED,SAAS,CAACC,QAAQ,GAAGA,QAAQ;IAC/B,CAAC;IAED,EAAE,EAAEH,UAAU,CAACO,IAAI,EAAE,CAAC;YAYhBL,GAAgB;QAXpBA,SAAS,CAACM,MAAM,OAtBc,kBAAgC,oBAsBzB,CAAC;YACpCC,OAAO,MAxBmB,SAA8B,kBAwB/BV,OAAO,IAAI,CAAC;YAAA,CAAC;YACtCA,OAAO,EAAEA,OAAO;YAChBC,UAAU,EAAE,CAAC;gBACXG,QAAQ,EAAEH,UAAU,CAACG,QAAQ;gBAC7BI,IAAI,EAAEP,UAAU,CAACO,IAAI;gBACrBG,aAAa,EAAEV,UAAU,CAACU,aAAa;YACzC,CAAC;YACDT,GAAG,EAAEC,SAAS;QAChB,CAAC;QAED,EAAE,GAAEA,GAAgB,GAAhBA,SAAS,CAACM,MAAM,cAAhBN,GAAgB,KAAhBA,IAAI,CAAJA,CAAsB,GAAtBA,IAAI,CAAJA,CAAsB,GAAtBA,GAAgB,CAAES,IAAI,CAACC,cAAc,EAAE,CAAC;YAC1CV,SAAS,CAACE,QAAQ,GAAGF,SAAS,CAACM,MAAM,CAACG,IAAI,CAACP,QAAQ;QACrD,CAAC;IACH,CAAC;IAED,MAAM,CAACF,SAAS;AAClB,CAAC"}