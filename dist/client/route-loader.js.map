{"version":3,"sources":["../../client/route-loader.ts"],"sourcesContent":["import { ComponentType } from 'react'\nimport { ClientBuildManifest } from '../build/webpack/plugins/build-manifest-plugin'\nimport getAssetPathFromRoute from '../shared/lib/router/utils/get-asset-path-from-route'\nimport { requestIdleCallback } from './request-idle-callback'\n\n// 3.8s was arbitrarily chosen as it's what https://web.dev/interactive\n// considers as \"Good\" time-to-interactive. We must assume something went\n// wrong beyond this point, and then fall-back to a full page transition to\n// show the user something of value.\nconst MS_MAX_IDLE_DELAY = 3800\n\ndeclare global {\n  interface Window {\n    __BUILD_MANIFEST?: ClientBuildManifest\n    __BUILD_MANIFEST_CB?: Function\n  }\n}\n\nexport interface LoadedEntrypointSuccess {\n  component: ComponentType\n  exports: any\n}\nexport interface LoadedEntrypointFailure {\n  error: unknown\n}\nexport type RouteEntrypoint = LoadedEntrypointSuccess | LoadedEntrypointFailure\n\nexport interface RouteStyleSheet {\n  href: string\n  content: string\n}\n\nexport interface LoadedRouteSuccess extends LoadedEntrypointSuccess {\n  styles: RouteStyleSheet[]\n}\nexport interface LoadedRouteFailure {\n  error: unknown\n}\nexport type RouteLoaderEntry = LoadedRouteSuccess | LoadedRouteFailure\n\nexport type Future<V> = {\n  resolve: (entrypoint: V) => void\n  future: Promise<V>\n}\nfunction withFuture<T>(\n  key: string,\n  map: Map<string, Future<T> | T>,\n  generator?: () => Promise<T>\n): Promise<T> {\n  let entry: Future<T> | T | undefined = map.get(key)\n  if (entry) {\n    if ('future' in entry) {\n      return entry.future\n    }\n    return Promise.resolve(entry)\n  }\n  let resolver: (entrypoint: T) => void\n  const prom: Promise<T> = new Promise<T>((resolve) => {\n    resolver = resolve\n  })\n  map.set(key, (entry = { resolve: resolver!, future: prom }))\n  return generator\n    ? // eslint-disable-next-line no-sequences\n      generator().then((value) => (resolver(value), value))\n    : prom\n}\n\nexport interface RouteLoader {\n  whenEntrypoint(route: string): Promise<RouteEntrypoint>\n  onEntrypoint(route: string, execute: () => unknown): void\n  loadRoute(route: string, prefetch?: boolean): Promise<RouteLoaderEntry>\n  prefetch(route: string): Promise<void>\n}\n\nfunction hasPrefetch(link?: HTMLLinkElement): boolean {\n  try {\n    link = document.createElement('link')\n    return (\n      // detect IE11 since it supports prefetch but isn't detected\n      // with relList.support\n      (!!window.MSInputMethodContext && !!(document as any).documentMode) ||\n      link.relList.supports('prefetch')\n    )\n  } catch {\n    return false\n  }\n}\n\nconst canPrefetch: boolean = hasPrefetch()\n\nfunction prefetchViaDom(\n  href: string,\n  as: string,\n  link?: HTMLLinkElement\n): Promise<any> {\n  return new Promise<void>((res, rej) => {\n    if (document.querySelector(`link[rel=\"prefetch\"][href^=\"${href}\"]`)) {\n      return res()\n    }\n\n    link = document.createElement('link')\n\n    // The order of property assignment here is intentional:\n    if (as) link!.as = as\n    link!.rel = `prefetch`\n    link!.crossOrigin = process.env.__NEXT_CROSS_ORIGIN!\n    link!.onload = res as any\n    link!.onerror = rej\n\n    // `href` should always be last:\n    link!.href = href\n\n    document.head.appendChild(link)\n  })\n}\n\nconst ASSET_LOAD_ERROR = Symbol('ASSET_LOAD_ERROR')\n// TODO: unexport\nexport function markAssetError(err: Error): Error {\n  return Object.defineProperty(err, ASSET_LOAD_ERROR, {})\n}\n\nexport function isAssetError(err?: Error): boolean | undefined {\n  return err && ASSET_LOAD_ERROR in err\n}\n\nfunction appendScript(\n  src: string,\n  script?: HTMLScriptElement\n): Promise<unknown> {\n  return new Promise((resolve, reject) => {\n    script = document.createElement('script')\n\n    // The order of property assignment here is intentional.\n    // 1. Setup success/failure hooks in case the browser synchronously\n    //    executes when `src` is set.\n    script.onload = resolve\n    script.onerror = () =>\n      reject(markAssetError(new Error(`Failed to load script: ${src}`)))\n\n    // 2. Configure the cross-origin attribute before setting `src` in case the\n    //    browser begins to fetch.\n    script.crossOrigin = process.env.__NEXT_CROSS_ORIGIN!\n\n    // 3. Finally, set the source and inject into the DOM in case the child\n    //    must be appended for fetching to start.\n    script.src = src\n    document.body.appendChild(script)\n  })\n}\n\n// We wait for pages to be built in dev before we start the route transition\n// timeout to prevent an un-necessary hard navigation in development.\nlet devBuildPromise: Promise<void> | undefined\n\n// Resolve a promise that times out after given amount of milliseconds.\nfunction resolvePromiseWithTimeout<T>(\n  p: Promise<T>,\n  ms: number,\n  err: Error\n): Promise<T> {\n  return new Promise((resolve, reject) => {\n    let cancelled = false\n\n    p.then((r) => {\n      // Resolved, cancel the timeout\n      cancelled = true\n      resolve(r)\n    }).catch(reject)\n\n    // We wrap these checks separately for better dead-code elimination in\n    // production bundles.\n    if (process.env.NODE_ENV === 'development') {\n      ;(devBuildPromise || Promise.resolve()).then(() => {\n        requestIdleCallback(() =>\n          setTimeout(() => {\n            if (!cancelled) {\n              reject(err)\n            }\n          }, ms)\n        )\n      })\n    }\n\n    if (process.env.NODE_ENV !== 'development') {\n      requestIdleCallback(() =>\n        setTimeout(() => {\n          if (!cancelled) {\n            reject(err)\n          }\n        }, ms)\n      )\n    }\n  })\n}\n\n// TODO: stop exporting or cache the failure\n// It'd be best to stop exporting this. It's an implementation detail. We're\n// only exporting it for backwards compatibility with the `page-loader`.\n// Only cache this response as a last resort if we cannot eliminate all other\n// code branches that use the Build Manifest Callback and push them through\n// the Route Loader interface.\nexport function getClientBuildManifest(): Promise<ClientBuildManifest> {\n  if (self.__BUILD_MANIFEST) {\n    return Promise.resolve(self.__BUILD_MANIFEST)\n  }\n\n  const onBuildManifest: Promise<ClientBuildManifest> =\n    new Promise<ClientBuildManifest>((resolve) => {\n      // Mandatory because this is not concurrent safe:\n      const cb = self.__BUILD_MANIFEST_CB\n      self.__BUILD_MANIFEST_CB = () => {\n        resolve(self.__BUILD_MANIFEST!)\n        cb && cb()\n      }\n    })\n\n  return resolvePromiseWithTimeout<ClientBuildManifest>(\n    onBuildManifest,\n    MS_MAX_IDLE_DELAY,\n    markAssetError(new Error('Failed to load client build manifest'))\n  )\n}\n\ninterface RouteFiles {\n  scripts: string[]\n  css: string[]\n}\nfunction getFilesForRoute(\n  assetPrefix: string,\n  route: string\n): Promise<RouteFiles> {\n  if (process.env.NODE_ENV === 'development') {\n    return Promise.resolve({\n      scripts: [\n        assetPrefix +\n          '/_next/static/chunks/pages' +\n          encodeURI(getAssetPathFromRoute(route, '.js')),\n      ],\n      // Styles are handled by `style-loader` in development:\n      css: [],\n    })\n  }\n  return getClientBuildManifest().then((manifest) => {\n    if (!(route in manifest)) {\n      throw markAssetError(new Error(`Failed to lookup route: ${route}`))\n    }\n    const allFiles = manifest[route].map(\n      (entry) => assetPrefix + '/_next/' + encodeURI(entry)\n    )\n    return {\n      scripts: allFiles.filter((v) => v.endsWith('.js')),\n      css: allFiles.filter((v) => v.endsWith('.css')),\n    }\n  })\n}\n\nexport function createRouteLoader(assetPrefix: string): RouteLoader {\n  const entrypoints: Map<string, Future<RouteEntrypoint> | RouteEntrypoint> =\n    new Map()\n  const loadedScripts: Map<string, Promise<unknown>> = new Map()\n  const styleSheets: Map<string, Promise<RouteStyleSheet>> = new Map()\n  const routes: Map<string, Future<RouteLoaderEntry> | RouteLoaderEntry> =\n    new Map()\n\n  function maybeExecuteScript(src: string): Promise<unknown> {\n    let prom: Promise<unknown> | undefined = loadedScripts.get(src)\n    if (prom) {\n      return prom\n    }\n\n    // Skip executing script if it's already in the DOM:\n    if (document.querySelector(`script[src^=\"${src}\"]`)) {\n      return Promise.resolve()\n    }\n\n    loadedScripts.set(src, (prom = appendScript(src)))\n    return prom\n  }\n\n  function fetchStyleSheet(href: string): Promise<RouteStyleSheet> {\n    let prom: Promise<RouteStyleSheet> | undefined = styleSheets.get(href)\n    if (prom) {\n      return prom\n    }\n\n    styleSheets.set(\n      href,\n      (prom = fetch(href)\n        .then((res) => {\n          if (!res.ok) {\n            throw new Error(`Failed to load stylesheet: ${href}`)\n          }\n          return res.text().then((text) => ({ href: href, content: text }))\n        })\n        .catch((err) => {\n          throw markAssetError(err)\n        }))\n    )\n    return prom\n  }\n\n  return {\n    whenEntrypoint(route: string) {\n      return withFuture(route, entrypoints)\n    },\n    onEntrypoint(route: string, execute: () => unknown) {\n      Promise.resolve(execute)\n        .then((fn) => fn())\n        .then(\n          (exports: any) => ({\n            component: (exports && exports.default) || exports,\n            exports: exports,\n          }),\n          (err) => ({ error: err })\n        )\n        .then((input: RouteEntrypoint) => {\n          const old = entrypoints.get(route)\n          entrypoints.set(route, input)\n          if (old && 'resolve' in old) old.resolve(input)\n        })\n    },\n    loadRoute(route: string, prefetch?: boolean) {\n      return withFuture<RouteLoaderEntry>(route, routes, () => {\n        const routeFilesPromise = getFilesForRoute(assetPrefix, route)\n          .then(({ scripts, css }) => {\n            return Promise.all([\n              entrypoints.has(route)\n                ? []\n                : Promise.all(scripts.map(maybeExecuteScript)),\n              Promise.all(css.map(fetchStyleSheet)),\n            ] as const)\n          })\n          .then((res) => {\n            return this.whenEntrypoint(route).then((entrypoint) => ({\n              entrypoint,\n              styles: res[1],\n            }))\n          })\n\n        if (process.env.NODE_ENV === 'development') {\n          devBuildPromise = new Promise<void>((resolve) => {\n            if (routeFilesPromise) {\n              return routeFilesPromise.finally(() => {\n                resolve()\n              })\n            }\n          })\n        }\n\n        return resolvePromiseWithTimeout(\n          routeFilesPromise,\n          MS_MAX_IDLE_DELAY,\n          markAssetError(new Error(`Route did not complete loading: ${route}`))\n        )\n          .then(({ entrypoint, styles }) => {\n            const res: RouteLoaderEntry = Object.assign<\n              { styles: RouteStyleSheet[] },\n              RouteEntrypoint\n            >({ styles: styles! }, entrypoint)\n            return 'error' in entrypoint ? entrypoint : res\n          })\n          .catch((err) => {\n            if (prefetch) {\n              // we don't want to cache errors during prefetch\n              throw err\n            }\n            return { error: err }\n          })\n      })\n    },\n    prefetch(route: string): Promise<void> {\n      // https://github.com/GoogleChromeLabs/quicklink/blob/453a661fa1fa940e2d2e044452398e38c67a98fb/src/index.mjs#L115-L118\n      // License: Apache 2.0\n      let cn\n      if ((cn = (navigator as any).connection)) {\n        // Don't prefetch if using 2G or if Save-Data is enabled.\n        if (cn.saveData || /2g/.test(cn.effectiveType)) return Promise.resolve()\n      }\n      return getFilesForRoute(assetPrefix, route)\n        .then((output) =>\n          Promise.all(\n            canPrefetch\n              ? output.scripts.map((script) => prefetchViaDom(script, 'script'))\n              : []\n          )\n        )\n        .then(() => {\n          requestIdleCallback(() => this.loadRoute(route, true).catch(() => {}))\n        })\n        .catch(\n          // swallow prefetch errors\n          () => {}\n        )\n    },\n  }\n}\n"],"names":["markAssetError","isAssetError","getClientBuildManifest","createRouteLoader","MS_MAX_IDLE_DELAY","withFuture","key","map","generator","entry","get","future","Promise","resolve","resolver","prom","set","then","value","hasPrefetch","link","document","createElement","window","MSInputMethodContext","documentMode","relList","supports","canPrefetch","prefetchViaDom","href","as","res","rej","querySelector","rel","crossOrigin","process","env","__NEXT_CROSS_ORIGIN","onload","onerror","head","appendChild","ASSET_LOAD_ERROR","Symbol","err","Object","defineProperty","appendScript","src","script","reject","Error","body","devBuildPromise","resolvePromiseWithTimeout","p","ms","cancelled","r","catch","NODE_ENV","setTimeout","self","__BUILD_MANIFEST","onBuildManifest","cb","__BUILD_MANIFEST_CB","getFilesForRoute","assetPrefix","route","scripts","encodeURI","css","manifest","allFiles","filter","v","endsWith","entrypoints","Map","loadedScripts","styleSheets","routes","maybeExecuteScript","fetchStyleSheet","fetch","ok","text","content","whenEntrypoint","onEntrypoint","execute","fn","exports","component","default","error","input","old","loadRoute","prefetch","routeFilesPromise","all","has","entrypoint","styles","finally","assign","cn","navigator","connection","saveData","test","effectiveType","output"],"mappings":";;;;QAsHgBA,cAAc,GAAdA,cAAc;QAIdC,YAAY,GAAZA,YAAY;QAgFZC,sBAAsB,GAAtBA,sBAAsB;QAuDtBC,iBAAiB,GAAjBA,iBAAiB;AA/PC,GAAsD,CAAtD,sBAAsD;AACpD,GAAyB,CAAzB,oBAAyB;;;;;;AAE7D,EAAuE,AAAvE,qEAAuE;AACvE,EAAyE,AAAzE,uEAAyE;AACzE,EAA2E,AAA3E,yEAA2E;AAC3E,EAAoC,AAApC,kCAAoC;AACpC,KAAK,CAACC,iBAAiB,GAAG,IAAI;SAmCrBC,UAAU,CACjBC,GAAW,EACXC,GAA+B,EAC/BC,SAA4B,EAChB,CAAC;IACb,GAAG,CAACC,KAAK,GAA8BF,GAAG,CAACG,GAAG,CAACJ,GAAG;IAClD,EAAE,EAAEG,KAAK,EAAE,CAAC;QACV,EAAE,EAAE,CAAQ,WAAIA,KAAK,EAAE,CAAC;YACtB,MAAM,CAACA,KAAK,CAACE,MAAM;QACrB,CAAC;QACD,MAAM,CAACC,OAAO,CAACC,OAAO,CAACJ,KAAK;IAC9B,CAAC;IACD,GAAG,CAACK,QAAQ;IACZ,KAAK,CAACC,IAAI,GAAe,GAAG,CAACH,OAAO,EAAKC,OAAO,GAAK,CAAC;QACpDC,QAAQ,GAAGD,OAAO;IACpB,CAAC;IACDN,GAAG,CAACS,GAAG,CAACV,GAAG,EAAGG,KAAK,GAAG,CAAC;QAACI,OAAO,EAAEC,QAAQ;QAAGH,MAAM,EAAEI,IAAI;IAAC,CAAC;IAC1D,MAAM,CAACP,SAAS,GAEZA,SAAS,GAAGS,IAAI,EAAEC,KAAK,IAAMJ,QAAQ,CAACI,KAAK,GAAGA,KAAK;QACnDH,IAAI;AACV,CAAC;SASQI,WAAW,CAACC,IAAsB,EAAW,CAAC;IACrD,GAAG,CAAC,CAAC;QACHA,IAAI,GAAGC,QAAQ,CAACC,aAAa,CAAC,CAAM;QACpC,MAAM,CACJ,EAA4D,AAA5D,0DAA4D;QAC5D,EAAuB,AAAvB,qBAAuB;WACpBC,MAAM,CAACC,oBAAoB,MAAOH,QAAQ,CAASI,YAAY,KAClEL,IAAI,CAACM,OAAO,CAACC,QAAQ,CAAC,CAAU;IAEpC,CAAC,CAAC,KAAK,KAAC,CAAC;QACP,MAAM,CAAC,KAAK;IACd,CAAC;AACH,CAAC;AAED,KAAK,CAACC,WAAW,GAAYT,WAAW;SAE/BU,cAAc,CACrBC,IAAY,EACZC,EAAU,EACVX,IAAsB,EACR,CAAC;IACf,MAAM,CAAC,GAAG,CAACR,OAAO,EAAQoB,GAAG,EAAEC,GAAG,GAAK,CAAC;QACtC,EAAE,EAAEZ,QAAQ,CAACa,aAAa,EAAE,4BAA4B,EAAEJ,IAAI,CAAC,EAAE,IAAI,CAAC;YACpE,MAAM,CAACE,GAAG;QACZ,CAAC;QAEDZ,IAAI,GAAGC,QAAQ,CAACC,aAAa,CAAC,CAAM;QAEpC,EAAwD,AAAxD,sDAAwD;QACxD,EAAE,EAAES,EAAE,EAAEX,IAAI,CAAEW,EAAE,GAAGA,EAAE;QACrBX,IAAI,CAAEe,GAAG,IAAI,QAAQ;QACrBf,IAAI,CAAEgB,WAAW,GAAGC,OAAO,CAACC,GAAG,CAACC,mBAAmB;QACnDnB,IAAI,CAAEoB,MAAM,GAAGR,GAAG;QAClBZ,IAAI,CAAEqB,OAAO,GAAGR,GAAG;QAEnB,EAAgC,AAAhC,8BAAgC;QAChCb,IAAI,CAAEU,IAAI,GAAGA,IAAI;QAEjBT,QAAQ,CAACqB,IAAI,CAACC,WAAW,CAACvB,IAAI;IAChC,CAAC;AACH,CAAC;AAED,KAAK,CAACwB,gBAAgB,GAAGC,MAAM,CAAC,CAAkB;SAElC7C,cAAc,CAAC8C,GAAU,EAAS,CAAC;IACjD,MAAM,CAACC,MAAM,CAACC,cAAc,CAACF,GAAG,EAAEF,gBAAgB,EAAE,CAAC;IAAA,CAAC;AACxD,CAAC;SAEe3C,YAAY,CAAC6C,GAAW,EAAuB,CAAC;IAC9D,MAAM,CAACA,GAAG,IAAIF,gBAAgB,IAAIE,GAAG;AACvC,CAAC;SAEQG,YAAY,CACnBC,GAAW,EACXC,MAA0B,EACR,CAAC;IACnB,MAAM,CAAC,GAAG,CAACvC,OAAO,EAAEC,OAAO,EAAEuC,MAAM,GAAK,CAAC;QACvCD,MAAM,GAAG9B,QAAQ,CAACC,aAAa,CAAC,CAAQ;QAExC,EAAwD,AAAxD,sDAAwD;QACxD,EAAmE,AAAnE,iEAAmE;QACnE,EAAiC,AAAjC,+BAAiC;QACjC6B,MAAM,CAACX,MAAM,GAAG3B,OAAO;QACvBsC,MAAM,CAACV,OAAO,OACZW,MAAM,CAACpD,cAAc,CAAC,GAAG,CAACqD,KAAK,EAAE,uBAAuB,EAAEH,GAAG;;QAE/D,EAA2E,AAA3E,yEAA2E;QAC3E,EAA8B,AAA9B,4BAA8B;QAC9BC,MAAM,CAACf,WAAW,GAAGC,OAAO,CAACC,GAAG,CAACC,mBAAmB;QAEpD,EAAuE,AAAvE,qEAAuE;QACvE,EAA6C,AAA7C,2CAA6C;QAC7CY,MAAM,CAACD,GAAG,GAAGA,GAAG;QAChB7B,QAAQ,CAACiC,IAAI,CAACX,WAAW,CAACQ,MAAM;IAClC,CAAC;AACH,CAAC;AAED,EAA4E,AAA5E,0EAA4E;AAC5E,EAAqE,AAArE,mEAAqE;AACrE,GAAG,CAACI,eAAe;AAEnB,EAAuE,AAAvE,qEAAuE;SAC9DC,yBAAyB,CAChCC,CAAa,EACbC,EAAU,EACVZ,GAAU,EACE,CAAC;IACb,MAAM,CAAC,GAAG,CAAClC,OAAO,EAAEC,OAAO,EAAEuC,MAAM,GAAK,CAAC;QACvC,GAAG,CAACO,SAAS,GAAG,KAAK;QAErBF,CAAC,CAACxC,IAAI,EAAE2C,CAAC,GAAK,CAAC;YACb,EAA+B,AAA/B,6BAA+B;YAC/BD,SAAS,GAAG,IAAI;YAChB9C,OAAO,CAAC+C,CAAC;QACX,CAAC,EAAEC,KAAK,CAACT,MAAM;QAEf,EAAsE,AAAtE,oEAAsE;QACtE,EAAsB,AAAtB,oBAAsB;QACtB,EAAE,EAAEf,OAAO,CAACC,GAAG,CAACwB,QAAQ,KAAK,CAAa,cAAE,CAAC;aACzCP,eAAe,IAAI3C,OAAO,CAACC,OAAO,IAAII,IAAI,KAAO,CAAC;oBA1KtB,oBAAyB,0BA4KnD8C,UAAU,KAAO,CAAC;wBAChB,EAAE,GAAGJ,SAAS,EAAE,CAAC;4BACfP,MAAM,CAACN,GAAG;wBACZ,CAAC;oBACH,CAAC,EAAEY,EAAE;;YAET,CAAC;QACH,CAAC;QAED,EAAE,EAAErB,OAAO,CAACC,GAAG,CAACwB,QAAQ,KAAK,CAAa,cAAE,CAAC;gBArLb,oBAAyB,0BAuLrDC,UAAU,KAAO,CAAC;oBAChB,EAAE,GAAGJ,SAAS,EAAE,CAAC;wBACfP,MAAM,CAACN,GAAG;oBACZ,CAAC;gBACH,CAAC,EAAEY,EAAE;;QAET,CAAC;IACH,CAAC;AACH,CAAC;SAQexD,sBAAsB,GAAiC,CAAC;IACtE,EAAE,EAAE8D,IAAI,CAACC,gBAAgB,EAAE,CAAC;QAC1B,MAAM,CAACrD,OAAO,CAACC,OAAO,CAACmD,IAAI,CAACC,gBAAgB;IAC9C,CAAC;IAED,KAAK,CAACC,eAAe,GACnB,GAAG,CAACtD,OAAO,EAAuBC,OAAO,GAAK,CAAC;QAC7C,EAAiD,AAAjD,+CAAiD;QACjD,KAAK,CAACsD,EAAE,GAAGH,IAAI,CAACI,mBAAmB;QACnCJ,IAAI,CAACI,mBAAmB,OAAS,CAAC;YAChCvD,OAAO,CAACmD,IAAI,CAACC,gBAAgB;YAC7BE,EAAE,IAAIA,EAAE;QACV,CAAC;IACH,CAAC;IAEH,MAAM,CAACX,yBAAyB,CAC9BU,eAAe,EACf9D,iBAAiB,EACjBJ,cAAc,CAAC,GAAG,CAACqD,KAAK,CAAC,CAAsC;AAEnE,CAAC;SAMQgB,gBAAgB,CACvBC,WAAmB,EACnBC,KAAa,EACQ,CAAC;IACtB,EAAE,EAAElC,OAAO,CAACC,GAAG,CAACwB,QAAQ,KAAK,CAAa,cAAE,CAAC;QAC3C,MAAM,CAAClD,OAAO,CAACC,OAAO,CAAC,CAAC;YACtB2D,OAAO,EAAE,CAAC;gBACRF,WAAW,GACT,CAA4B,8BAC5BG,SAAS,KA3Oe,sBAAsD,UA2O9CF,KAAK,EAAE,CAAK;YAChD,CAAC;YACD,EAAuD,AAAvD,qDAAuD;YACvDG,GAAG,EAAE,CAAC,CAAC;QACT,CAAC;IACH,CAAC;IACD,MAAM,CAACxE,sBAAsB,GAAGe,IAAI,EAAE0D,QAAQ,GAAK,CAAC;QAClD,EAAE,IAAIJ,KAAK,IAAII,QAAQ,GAAG,CAAC;YACzB,KAAK,CAAC3E,cAAc,CAAC,GAAG,CAACqD,KAAK,EAAE,wBAAwB,EAAEkB,KAAK;QACjE,CAAC;QACD,KAAK,CAACK,QAAQ,GAAGD,QAAQ,CAACJ,KAAK,EAAEhE,GAAG,EACjCE,KAAK,GAAK6D,WAAW,GAAG,CAAS,WAAGG,SAAS,CAAChE,KAAK;;QAEtD,MAAM,CAAC,CAAC;YACN+D,OAAO,EAAEI,QAAQ,CAACC,MAAM,EAAEC,CAAC,GAAKA,CAAC,CAACC,QAAQ,CAAC,CAAK;;YAChDL,GAAG,EAAEE,QAAQ,CAACC,MAAM,EAAEC,CAAC,GAAKA,CAAC,CAACC,QAAQ,CAAC,CAAM;;QAC/C,CAAC;IACH,CAAC;AACH,CAAC;SAEe5E,iBAAiB,CAACmE,WAAmB,EAAe,CAAC;IACnE,KAAK,CAACU,WAAW,GACf,GAAG,CAACC,GAAG;IACT,KAAK,CAACC,aAAa,GAAkC,GAAG,CAACD,GAAG;IAC5D,KAAK,CAACE,WAAW,GAA0C,GAAG,CAACF,GAAG;IAClE,KAAK,CAACG,MAAM,GACV,GAAG,CAACH,GAAG;aAEAI,kBAAkB,CAACnC,GAAW,EAAoB,CAAC;QAC1D,GAAG,CAACnC,IAAI,GAAiCmE,aAAa,CAACxE,GAAG,CAACwC,GAAG;QAC9D,EAAE,EAAEnC,IAAI,EAAE,CAAC;YACT,MAAM,CAACA,IAAI;QACb,CAAC;QAED,EAAoD,AAApD,kDAAoD;QACpD,EAAE,EAAEM,QAAQ,CAACa,aAAa,EAAE,aAAa,EAAEgB,GAAG,CAAC,EAAE,IAAI,CAAC;YACpD,MAAM,CAACtC,OAAO,CAACC,OAAO;QACxB,CAAC;QAEDqE,aAAa,CAAClE,GAAG,CAACkC,GAAG,EAAGnC,IAAI,GAAGkC,YAAY,CAACC,GAAG;QAC/C,MAAM,CAACnC,IAAI;IACb,CAAC;aAEQuE,eAAe,CAACxD,IAAY,EAA4B,CAAC;QAChE,GAAG,CAACf,IAAI,GAAyCoE,WAAW,CAACzE,GAAG,CAACoB,IAAI;QACrE,EAAE,EAAEf,IAAI,EAAE,CAAC;YACT,MAAM,CAACA,IAAI;QACb,CAAC;QAEDoE,WAAW,CAACnE,GAAG,CACbc,IAAI,EACHf,IAAI,GAAGwE,KAAK,CAACzD,IAAI,EACfb,IAAI,EAAEe,GAAG,GAAK,CAAC;YACd,EAAE,GAAGA,GAAG,CAACwD,EAAE,EAAE,CAAC;gBACZ,KAAK,CAAC,GAAG,CAACnC,KAAK,EAAE,2BAA2B,EAAEvB,IAAI;YACpD,CAAC;YACD,MAAM,CAACE,GAAG,CAACyD,IAAI,GAAGxE,IAAI,EAAEwE,IAAI,IAAM,CAAC;oBAAC3D,IAAI,EAAEA,IAAI;oBAAE4D,OAAO,EAAED,IAAI;gBAAC,CAAC;;QACjE,CAAC,EACA5B,KAAK,EAAEf,GAAG,GAAK,CAAC;YACf,KAAK,CAAC9C,cAAc,CAAC8C,GAAG;QAC1B,CAAC;QAEL,MAAM,CAAC/B,IAAI;IACb,CAAC;IAED,MAAM,CAAC,CAAC;QACN4E,cAAc,EAACpB,KAAa,EAAE,CAAC;YAC7B,MAAM,CAAClE,UAAU,CAACkE,KAAK,EAAES,WAAW;QACtC,CAAC;QACDY,YAAY,EAACrB,KAAa,EAAEsB,OAAsB,EAAE,CAAC;YACnDjF,OAAO,CAACC,OAAO,CAACgF,OAAO,EACpB5E,IAAI,EAAE6E,EAAE,GAAKA,EAAE;cACf7E,IAAI,EACF8E,OAAY,IAAM,CAAC;oBAClBC,SAAS,EAAGD,OAAO,IAAIA,OAAO,CAACE,OAAO,IAAKF,OAAO;oBAClDA,OAAO,EAAEA,OAAO;gBAClB,CAAC;eACAjD,GAAG,IAAM,CAAC;oBAACoD,KAAK,EAAEpD,GAAG;gBAAC,CAAC;cAEzB7B,IAAI,EAAEkF,KAAsB,GAAK,CAAC;gBACjC,KAAK,CAACC,GAAG,GAAGpB,WAAW,CAACtE,GAAG,CAAC6D,KAAK;gBACjCS,WAAW,CAAChE,GAAG,CAACuD,KAAK,EAAE4B,KAAK;gBAC5B,EAAE,EAAEC,GAAG,IAAI,CAAS,YAAIA,GAAG,EAAEA,GAAG,CAACvF,OAAO,CAACsF,KAAK;YAChD,CAAC;QACL,CAAC;QACDE,SAAS,EAAC9B,KAAa,EAAE+B,QAAkB,EAAE,CAAC;YAC5C,MAAM,CAACjG,UAAU,CAAmBkE,KAAK,EAAEa,MAAM,MAAQ,CAAC;gBACxD,KAAK,CAACmB,iBAAiB,GAAGlC,gBAAgB,CAACC,WAAW,EAAEC,KAAK,EAC1DtD,IAAI,EAAE,CAAC,CAACuD,OAAO,GAAEE,GAAG,EAAC,CAAC,GAAK,CAAC;oBAC3B,MAAM,CAAC9D,OAAO,CAAC4F,GAAG,CAAC,CAAC;wBAClBxB,WAAW,CAACyB,GAAG,CAAClC,KAAK,IACjB,CAAC,CAAC,GACF3D,OAAO,CAAC4F,GAAG,CAAChC,OAAO,CAACjE,GAAG,CAAC8E,kBAAkB;wBAC9CzE,OAAO,CAAC4F,GAAG,CAAC9B,GAAG,CAACnE,GAAG,CAAC+E,eAAe;oBACrC,CAAC;gBACH,CAAC,EACArE,IAAI,EAAEe,GAAG,GAAK,CAAC;oBACd,MAAM,CAAC,IAAI,CAAC2D,cAAc,CAACpB,KAAK,EAAEtD,IAAI,EAAEyF,UAAU,IAAM,CAAC;4BACvDA,UAAU;4BACVC,MAAM,EAAE3E,GAAG,CAAC,CAAC;wBACf,CAAC;;gBACH,CAAC;gBAEH,EAAE,EAAEK,OAAO,CAACC,GAAG,CAACwB,QAAQ,KAAK,CAAa,cAAE,CAAC;oBAC3CP,eAAe,GAAG,GAAG,CAAC3C,OAAO,EAAQC,OAAO,GAAK,CAAC;wBAChD,EAAE,EAAE0F,iBAAiB,EAAE,CAAC;4BACtB,MAAM,CAACA,iBAAiB,CAACK,OAAO,KAAO,CAAC;gCACtC/F,OAAO;4BACT,CAAC;wBACH,CAAC;oBACH,CAAC;gBACH,CAAC;gBAED,MAAM,CAAC2C,yBAAyB,CAC9B+C,iBAAiB,EACjBnG,iBAAiB,EACjBJ,cAAc,CAAC,GAAG,CAACqD,KAAK,EAAE,gCAAgC,EAAEkB,KAAK,MAEhEtD,IAAI,EAAE,CAAC,CAACyF,UAAU,GAAEC,MAAM,EAAC,CAAC,GAAK,CAAC;oBACjC,KAAK,CAAC3E,GAAG,GAAqBe,MAAM,CAAC8D,MAAM,CAGzC,CAAC;wBAACF,MAAM,EAAEA,MAAM;oBAAE,CAAC,EAAED,UAAU;oBACjC,MAAM,CAAC,CAAO,UAAIA,UAAU,GAAGA,UAAU,GAAG1E,GAAG;gBACjD,CAAC,EACA6B,KAAK,EAAEf,GAAG,GAAK,CAAC;oBACf,EAAE,EAAEwD,QAAQ,EAAE,CAAC;wBACb,EAAgD,AAAhD,8CAAgD;wBAChD,KAAK,CAACxD,GAAG;oBACX,CAAC;oBACD,MAAM,CAAC,CAAC;wBAACoD,KAAK,EAAEpD,GAAG;oBAAC,CAAC;gBACvB,CAAC;YACL,CAAC;QACH,CAAC;QACDwD,QAAQ,EAAC/B,KAAa,EAAiB,CAAC;YACtC,EAAsH,AAAtH,oHAAsH;YACtH,EAAsB,AAAtB,oBAAsB;YACtB,GAAG,CAACuC,EAAE;YACN,EAAE,EAAGA,EAAE,GAAIC,SAAS,CAASC,UAAU,EAAG,CAAC;gBACzC,EAAyD,AAAzD,uDAAyD;gBACzD,EAAE,EAAEF,EAAE,CAACG,QAAQ,SAASC,IAAI,CAACJ,EAAE,CAACK,aAAa,GAAG,MAAM,CAACvG,OAAO,CAACC,OAAO;YACxE,CAAC;YACD,MAAM,CAACwD,gBAAgB,CAACC,WAAW,EAAEC,KAAK,EACvCtD,IAAI,EAAEmG,MAAM,GACXxG,OAAO,CAAC4F,GAAG,CACT5E,WAAW,GACPwF,MAAM,CAAC5C,OAAO,CAACjE,GAAG,EAAE4C,MAAM,GAAKtB,cAAc,CAACsB,MAAM,EAAE,CAAQ;oBAC9D,CAAC,CAAC;cAGTlC,IAAI,KAAO,CAAC;oBAhYe,oBAAyB,0BAiYzB,IAAI,CAACoF,SAAS,CAAC9B,KAAK,EAAE,IAAI,EAAEV,KAAK,KAAO,CAAC;oBAAA,CAAC;;YACtE,CAAC,EACAA,KAAK,CACJ,EAA0B,AAA1B,wBAA0B;gBACpB,CAAC;YAAA,CAAC;QAEd,CAAC;IACH,CAAC;AACH,CAAC"}