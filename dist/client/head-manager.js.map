{"version":3,"sources":["../../client/head-manager.ts"],"sourcesContent":["export const DOMAttributeNames: Record<string, string> = {\n  acceptCharset: 'accept-charset',\n  className: 'class',\n  htmlFor: 'for',\n  httpEquiv: 'http-equiv',\n  noModule: 'noModule',\n}\n\nfunction reactElementToDOM({ type, props }: JSX.Element): HTMLElement {\n  const el: HTMLElement = document.createElement(type)\n  for (const p in props) {\n    if (!props.hasOwnProperty(p)) continue\n    if (p === 'children' || p === 'dangerouslySetInnerHTML') continue\n\n    // we don't render undefined props to the DOM\n    if (props[p] === undefined) continue\n\n    const attr = DOMAttributeNames[p] || p.toLowerCase()\n    if (\n      type === 'script' &&\n      (attr === 'async' || attr === 'defer' || attr === 'noModule')\n    ) {\n      ;(el as HTMLScriptElement)[attr] = !!props[p]\n    } else {\n      el.setAttribute(attr, props[p])\n    }\n  }\n\n  const { children, dangerouslySetInnerHTML } = props\n  if (dangerouslySetInnerHTML) {\n    el.innerHTML = dangerouslySetInnerHTML.__html || ''\n  } else if (children) {\n    el.textContent =\n      typeof children === 'string'\n        ? children\n        : Array.isArray(children)\n        ? children.join('')\n        : ''\n  }\n  return el\n}\n\nfunction updateElements(type: string, components: JSX.Element[]): void {\n  const headEl = document.getElementsByTagName('head')[0]\n  const headCountEl: HTMLMetaElement = headEl.querySelector(\n    'meta[name=next-head-count]'\n  ) as HTMLMetaElement\n  if (process.env.NODE_ENV !== 'production') {\n    if (!headCountEl) {\n      console.error(\n        'Warning: next-head-count is missing. https://nextjs.org/docs/messages/next-head-count-missing'\n      )\n      return\n    }\n  }\n\n  const headCount = Number(headCountEl.content)\n  const oldTags: Element[] = []\n\n  for (\n    let i = 0, j = headCountEl.previousElementSibling;\n    i < headCount;\n    i++, j = j!.previousElementSibling\n  ) {\n    if (j!.tagName.toLowerCase() === type) {\n      oldTags.push(j!)\n    }\n  }\n  const newTags = (components.map(reactElementToDOM) as HTMLElement[]).filter(\n    (newTag) => {\n      for (let k = 0, len = oldTags.length; k < len; k++) {\n        const oldTag = oldTags[k]\n        if (oldTag.isEqualNode(newTag)) {\n          oldTags.splice(k, 1)\n          return false\n        }\n      }\n      return true\n    }\n  )\n\n  oldTags.forEach((t) => t.parentNode!.removeChild(t))\n  newTags.forEach((t) => headEl.insertBefore(t, headCountEl))\n  headCountEl.content = (headCount - oldTags.length + newTags.length).toString()\n}\n\nexport default function initHeadManager(): {\n  mountedInstances: Set<unknown>\n  updateHead: (head: JSX.Element[]) => void\n} {\n  let updatePromise: Promise<void> | null = null\n\n  return {\n    mountedInstances: new Set(),\n    updateHead: (head: JSX.Element[]) => {\n      const promise = (updatePromise = Promise.resolve().then(() => {\n        if (promise !== updatePromise) return\n\n        updatePromise = null\n        const tags: Record<string, JSX.Element[]> = {}\n\n        head.forEach((h) => {\n          if (\n            // If the font tag is loaded only on client navigation\n            // it won't be inlined. In this case revert to the original behavior\n            h.type === 'link' &&\n            h.props['data-optimized-fonts'] &&\n            !document.querySelector(\n              `style[data-href=\"${h.props['data-href']}\"]`\n            )\n          ) {\n            h.props.href = h.props['data-href']\n            h.props['data-href'] = undefined\n          }\n          const components = tags[h.type] || []\n          components.push(h)\n          tags[h.type] = components\n        })\n\n        const titleComponent = tags.title ? tags.title[0] : null\n        let title = ''\n        if (titleComponent) {\n          const { children } = titleComponent.props\n          title =\n            typeof children === 'string'\n              ? children\n              : Array.isArray(children)\n              ? children.join('')\n              : ''\n        }\n        if (title !== document.title) document.title = title\n        ;['meta', 'base', 'link', 'style', 'script'].forEach((type) => {\n          updateElements(type, tags[type] || [])\n        })\n      }))\n    },\n  }\n}\n"],"names":["initHeadManager","DOMAttributeNames","acceptCharset","className","htmlFor","httpEquiv","noModule","reactElementToDOM","type","props","el","document","createElement","p","hasOwnProperty","undefined","attr","toLowerCase","setAttribute","children","dangerouslySetInnerHTML","innerHTML","__html","textContent","Array","isArray","join","updateElements","components","headEl","getElementsByTagName","headCountEl","querySelector","process","env","NODE_ENV","console","error","headCount","Number","content","oldTags","i","j","previousElementSibling","tagName","push","newTags","map","filter","newTag","k","len","length","oldTag","isEqualNode","splice","forEach","t","parentNode","removeChild","insertBefore","toString","updatePromise","mountedInstances","Set","updateHead","head","promise","Promise","resolve","then","tags","h","href","titleComponent","title"],"mappings":"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"}