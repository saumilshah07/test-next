{"version":3,"sources":["../../../../client/dev/error-overlay/eventsource.js"],"sourcesContent":["const eventCallbacks = []\n\nfunction EventSourceWrapper(options) {\n  var source\n  var lastActivity = new Date()\n  var listeners = []\n\n  if (!options.timeout) {\n    options.timeout = 20 * 1000\n  }\n\n  init()\n  var timer = setInterval(function () {\n    if (new Date() - lastActivity > options.timeout) {\n      handleDisconnect()\n    }\n  }, options.timeout / 2)\n\n  function init() {\n    source = new window.EventSource(options.path)\n    source.onopen = handleOnline\n    source.onerror = handleDisconnect\n    source.onmessage = handleMessage\n  }\n\n  function handleOnline() {\n    if (options.log) console.log('[HMR] connected')\n    lastActivity = new Date()\n  }\n\n  function handleMessage(event) {\n    lastActivity = new Date()\n    for (var i = 0; i < listeners.length; i++) {\n      listeners[i](event)\n    }\n\n    eventCallbacks.forEach((cb) => {\n      if (!cb.unfiltered && event.data.indexOf('action') === -1) return\n      cb(event)\n    })\n  }\n\n  function handleDisconnect() {\n    clearInterval(timer)\n    source.close()\n    setTimeout(init, options.timeout)\n  }\n\n  return {\n    close: () => {\n      clearInterval(timer)\n      source.close()\n    },\n    addMessageListener: function (fn) {\n      listeners.push(fn)\n    },\n  }\n}\n\nexport function addMessageListener(cb) {\n  eventCallbacks.push(cb)\n}\n\nexport function getEventSourceWrapper(options) {\n  return EventSourceWrapper(options)\n}\n"],"names":["addMessageListener","getEventSourceWrapper","eventCallbacks","EventSourceWrapper","options","source","lastActivity","Date","listeners","timeout","init","timer","setInterval","handleDisconnect","window","EventSource","path","onopen","handleOnline","onerror","onmessage","handleMessage","log","console","event","i","length","forEach","cb","unfiltered","data","indexOf","clearInterval","close","setTimeout","fn","push"],"mappings":";;;;QA2DgBA,kBAAkB,GAAlBA,kBAAkB;QAIlBC,qBAAqB,GAArBA,qBAAqB;AA/DrC,KAAK,CAACC,cAAc,GAAG,CAAC,CAAC;SAEhBC,kBAAkB,CAACC,OAAO,EAAE,CAAC;IACpC,GAAG,CAACC,MAAM;IACV,GAAG,CAACC,YAAY,GAAG,GAAG,CAACC,IAAI;IAC3B,GAAG,CAACC,SAAS,GAAG,CAAC,CAAC;IAElB,EAAE,GAAGJ,OAAO,CAACK,OAAO,EAAE,CAAC;QACrBL,OAAO,CAACK,OAAO,GAAG,EAAE,GAAG,IAAI;IAC7B,CAAC;IAEDC,IAAI;IACJ,GAAG,CAACC,KAAK,GAAGC,WAAW,CAAC,QAAQ,GAAI,CAAC;QACnC,EAAE,EAAE,GAAG,CAACL,IAAI,KAAKD,YAAY,GAAGF,OAAO,CAACK,OAAO,EAAE,CAAC;YAChDI,gBAAgB;QAClB,CAAC;IACH,CAAC,EAAET,OAAO,CAACK,OAAO,GAAG,CAAC;aAEbC,IAAI,GAAG,CAAC;QACfL,MAAM,GAAG,GAAG,CAACS,MAAM,CAACC,WAAW,CAACX,OAAO,CAACY,IAAI;QAC5CX,MAAM,CAACY,MAAM,GAAGC,YAAY;QAC5Bb,MAAM,CAACc,OAAO,GAAGN,gBAAgB;QACjCR,MAAM,CAACe,SAAS,GAAGC,aAAa;IAClC,CAAC;aAEQH,YAAY,GAAG,CAAC;QACvB,EAAE,EAAEd,OAAO,CAACkB,GAAG,EAAEC,OAAO,CAACD,GAAG,CAAC,CAAiB;QAC9ChB,YAAY,GAAG,GAAG,CAACC,IAAI;IACzB,CAAC;aAEQc,aAAa,CAACG,KAAK,EAAE,CAAC;QAC7BlB,YAAY,GAAG,GAAG,CAACC,IAAI;QACvB,GAAG,CAAE,GAAG,CAACkB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGjB,SAAS,CAACkB,MAAM,EAAED,CAAC,GAAI,CAAC;YAC1CjB,SAAS,CAACiB,CAAC,EAAED,KAAK;QACpB,CAAC;QAEDtB,cAAc,CAACyB,OAAO,EAAEC,EAAE,GAAK,CAAC;YAC9B,EAAE,GAAGA,EAAE,CAACC,UAAU,IAAIL,KAAK,CAACM,IAAI,CAACC,OAAO,CAAC,CAAQ,cAAO,CAAC,EAAE,MAAM;YACjEH,EAAE,CAACJ,KAAK;QACV,CAAC;IACH,CAAC;aAEQX,gBAAgB,GAAG,CAAC;QAC3BmB,aAAa,CAACrB,KAAK;QACnBN,MAAM,CAAC4B,KAAK;QACZC,UAAU,CAACxB,IAAI,EAAEN,OAAO,CAACK,OAAO;IAClC,CAAC;IAED,MAAM,CAAC,CAAC;QACNwB,KAAK,MAAQ,CAAC;YACZD,aAAa,CAACrB,KAAK;YACnBN,MAAM,CAAC4B,KAAK;QACd,CAAC;QACDjC,kBAAkB,EAAE,QAAQ,CAAEmC,EAAE,EAAE,CAAC;YACjC3B,SAAS,CAAC4B,IAAI,CAACD,EAAE;QACnB,CAAC;IACH,CAAC;AACH,CAAC;SAEenC,kBAAkB,CAAC4B,EAAE,EAAE,CAAC;IACtC1B,cAAc,CAACkC,IAAI,CAACR,EAAE;AACxB,CAAC;SAEe3B,qBAAqB,CAACG,OAAO,EAAE,CAAC;IAC9C,MAAM,CAACD,kBAAkB,CAACC,OAAO;AACnC,CAAC"}