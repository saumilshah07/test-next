{"version":3,"sources":["../../../client/dev/on-demand-entries-utils.js"],"sourcesContent":["/* global location */\nimport { getEventSourceWrapper } from './error-overlay/eventsource'\n\nlet evtSource\nexport let currentPage\n\nexport function closePing() {\n  if (evtSource) evtSource.close()\n  evtSource = null\n}\n\nexport function setupPing(assetPrefix, pathnameFn, retry) {\n  const pathname = pathnameFn()\n\n  // Make sure to only create new EventSource request if page has changed\n  if (pathname === currentPage && !retry) return\n  currentPage = pathname\n  // close current EventSource connection\n  closePing()\n\n  evtSource = getEventSourceWrapper({\n    path: `${assetPrefix}/_next/webpack-hmr?page=${encodeURIComponent(\n      currentPage\n    )}`,\n    timeout: 5000,\n  })\n\n  evtSource.addMessageListener((event) => {\n    if (event.data.indexOf('{') === -1) return\n    try {\n      const payload = JSON.parse(event.data)\n      // don't attempt fetching the page if we're already showing\n      // the dev overlay as this can cause the error to be triggered\n      // repeatedly\n      if (payload.invalid && !self.__NEXT_DATA__.err) {\n        // Payload can be invalid even if the page does not exist.\n        // So, we need to make sure it exists before reloading.\n        fetch(location.href, {\n          credentials: 'same-origin',\n        }).then((pageRes) => {\n          if (pageRes.status === 200) {\n            location.reload()\n          }\n        })\n      }\n    } catch (err) {\n      console.error('on-demand-entries failed to parse response', err)\n    }\n  })\n}\n"],"names":["closePing","setupPing","evtSource","currentPage","close","assetPrefix","pathnameFn","retry","pathname","path","encodeURIComponent","timeout","addMessageListener","event","data","indexOf","payload","JSON","parse","invalid","self","__NEXT_DATA__","err","fetch","location","href","credentials","then","pageRes","status","reload","console","error"],"mappings":";;;;QAMgBA,SAAS,GAATA,SAAS;QAKTC,SAAS,GAATA,SAAS;;AAVa,GAA6B,CAA7B,YAA6B;AAEnE,GAAG,CAACC,SAAS;AACN,GAAG,CAACC,WAAW;QAAXA,WAAW,GAAXA,WAAW;SAENH,SAAS,GAAG,CAAC;IAC3B,EAAE,EAAEE,SAAS,EAAEA,SAAS,CAACE,KAAK;IAC9BF,SAAS,GAAG,IAAI;AAClB,CAAC;SAEeD,SAAS,CAACI,WAAW,EAAEC,UAAU,EAAEC,KAAK,EAAE,CAAC;IACzD,KAAK,CAACC,QAAQ,GAAGF,UAAU;IAE3B,EAAuE,AAAvE,qEAAuE;IACvE,EAAE,EAAEE,QAAQ,KAAKL,WAAW,KAAKI,KAAK,EAAE,MAAM;0BAC9CJ,WAAW,GAAGK,QAAQ;IACtB,EAAuC,AAAvC,qCAAuC;IACvCR,SAAS;IAETE,SAAS,OAnB2B,YAA6B,wBAmB/B,CAAC;QACjCO,IAAI,KAAKJ,WAAW,CAAC,wBAAwB,EAAEK,kBAAkB,CAC/DP,WAAW;QAEbQ,OAAO,EAAE,IAAI;IACf,CAAC;IAEDT,SAAS,CAACU,kBAAkB,EAAEC,KAAK,GAAK,CAAC;QACvC,EAAE,EAAEA,KAAK,CAACC,IAAI,CAACC,OAAO,CAAC,CAAG,SAAO,CAAC,EAAE,MAAM;QAC1C,GAAG,CAAC,CAAC;YACH,KAAK,CAACC,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACL,KAAK,CAACC,IAAI;YACrC,EAA2D,AAA3D,yDAA2D;YAC3D,EAA8D,AAA9D,4DAA8D;YAC9D,EAAa,AAAb,WAAa;YACb,EAAE,EAAEE,OAAO,CAACG,OAAO,KAAKC,IAAI,CAACC,aAAa,CAACC,GAAG,EAAE,CAAC;gBAC/C,EAA0D,AAA1D,wDAA0D;gBAC1D,EAAuD,AAAvD,qDAAuD;gBACvDC,KAAK,CAACC,QAAQ,CAACC,IAAI,EAAE,CAAC;oBACpBC,WAAW,EAAE,CAAa;gBAC5B,CAAC,EAAEC,IAAI,EAAEC,OAAO,GAAK,CAAC;oBACpB,EAAE,EAAEA,OAAO,CAACC,MAAM,KAAK,GAAG,EAAE,CAAC;wBAC3BL,QAAQ,CAACM,MAAM;oBACjB,CAAC;gBACH,CAAC;YACH,CAAC;QACH,CAAC,CAAC,KAAK,EAAER,GAAG,EAAE,CAAC;YACbS,OAAO,CAACC,KAAK,CAAC,CAA4C,6CAAEV,GAAG;QACjE,CAAC;IACH,CAAC;AACH,CAAC"}