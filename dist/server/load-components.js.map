{"version":3,"sources":["../../server/load-components.ts"],"sourcesContent":["import {\n  BUILD_MANIFEST,\n  REACT_LOADABLE_MANIFEST,\n} from '../shared/lib/constants'\nimport { join } from 'path'\nimport { requirePage } from './require'\nimport { BuildManifest } from './get-page-files'\nimport { AppType, DocumentType } from '../shared/lib/utils'\nimport {\n  PageConfig,\n  GetStaticPaths,\n  GetServerSideProps,\n  GetStaticProps,\n} from 'next/types'\n\nexport function interopDefault(mod: any) {\n  return mod.default || mod\n}\n\nexport type ManifestItem = {\n  id: number | string\n  files: string[]\n}\n\ntype ReactLoadableManifest = { [moduleId: string]: ManifestItem }\n\nexport type LoadComponentsReturnType = {\n  Component: React.ComponentType\n  pageConfig?: PageConfig\n  buildManifest: BuildManifest\n  reactLoadableManifest: ReactLoadableManifest\n  Document: DocumentType\n  App: AppType\n  getStaticProps?: GetStaticProps\n  getStaticPaths?: GetStaticPaths\n  getServerSideProps?: GetServerSideProps\n  ComponentMod: any\n}\n\nexport async function loadDefaultErrorComponents(distDir: string) {\n  const Document = interopDefault(require('next/dist/pages/_document'))\n  const App = interopDefault(require('next/dist/pages/_app'))\n  const ComponentMod = require('next/dist/pages/_error')\n  const Component = interopDefault(ComponentMod)\n\n  return {\n    App,\n    Document,\n    Component,\n    buildManifest: require(join(distDir, `fallback-${BUILD_MANIFEST}`)),\n    reactLoadableManifest: {},\n    ComponentMod,\n  }\n}\n\nexport async function loadComponents(\n  distDir: string,\n  pathname: string,\n  serverless: boolean\n): Promise<LoadComponentsReturnType> {\n  if (serverless) {\n    const Component = await requirePage(pathname, distDir, serverless)\n    let { getStaticProps, getStaticPaths, getServerSideProps } = Component\n\n    getStaticProps = await getStaticProps\n    getStaticPaths = await getStaticPaths\n    getServerSideProps = await getServerSideProps\n    const pageConfig = (await Component.config) || {}\n\n    return {\n      Component,\n      pageConfig,\n      getStaticProps,\n      getStaticPaths,\n      getServerSideProps,\n      ComponentMod: Component,\n    } as LoadComponentsReturnType\n  }\n\n  const DocumentMod = await requirePage('/_document', distDir, serverless)\n  const AppMod = await requirePage('/_app', distDir, serverless)\n  const ComponentMod = await requirePage(pathname, distDir, serverless)\n\n  const [buildManifest, reactLoadableManifest, Component, Document, App] =\n    await Promise.all([\n      require(join(distDir, BUILD_MANIFEST)),\n      require(join(distDir, REACT_LOADABLE_MANIFEST)),\n      interopDefault(ComponentMod),\n      interopDefault(DocumentMod),\n      interopDefault(AppMod),\n    ])\n\n  const { getServerSideProps, getStaticProps, getStaticPaths } = ComponentMod\n\n  return {\n    App,\n    Document,\n    Component,\n    buildManifest,\n    reactLoadableManifest,\n    pageConfig: ComponentMod.config || {},\n    ComponentMod,\n    getServerSideProps,\n    getStaticProps,\n    getStaticPaths,\n  }\n}\n"],"names":["interopDefault","loadDefaultErrorComponents","loadComponents","mod","default","distDir","Document","require","App","ComponentMod","Component","buildManifest","reactLoadableManifest","pathname","serverless","getStaticProps","getStaticPaths","getServerSideProps","pageConfig","config","DocumentMod","AppMod","Promise","all"],"mappings":";;;;QAegBA,cAAc,GAAdA,cAAc;QAwBRC,0BAA0B,GAA1BA,0BAA0B;QAgB1BC,cAAc,GAAdA,cAAc;AApD7B,GAAyB,CAAzB,UAAyB;AACX,GAAM,CAAN,KAAM;AACC,GAAW,CAAX,QAAW;SAUvBF,cAAc,CAACG,GAAQ,EAAE,CAAC;IACxC,MAAM,CAACA,GAAG,CAACC,OAAO,IAAID,GAAG;AAC3B,CAAC;eAsBqBF,0BAA0B,CAACI,OAAe,EAAE,CAAC;IACjE,KAAK,CAACC,QAAQ,GAAGN,cAAc,CAACO,OAAO,CAAC,CAA2B;IACnE,KAAK,CAACC,GAAG,GAAGR,cAAc,CAACO,OAAO,CAAC,CAAsB;IACzD,KAAK,CAACE,YAAY,GAAGF,OAAO,CAAC,CAAwB;IACrD,KAAK,CAACG,SAAS,GAAGV,cAAc,CAACS,YAAY;IAE7C,MAAM,CAAC,CAAC;QACND,GAAG;QACHF,QAAQ;QACRI,SAAS;QACTC,aAAa,EAAEJ,OAAO,KA7CL,KAAM,OA6CKF,OAAO,GAAG,SAAS,EA9C5C,UAAyB;QA+C5BO,qBAAqB,EAAE,CAAC;QAAA,CAAC;QACzBH,YAAY;IACd,CAAC;AACH,CAAC;eAEqBP,cAAc,CAClCG,OAAe,EACfQ,QAAgB,EAChBC,UAAmB,EACgB,CAAC;IACpC,EAAE,EAAEA,UAAU,EAAE,CAAC;QACf,KAAK,CAACJ,SAAS,GAAG,KAAK,KAxDC,QAAW,cAwDCG,QAAQ,EAAER,OAAO,EAAES,UAAU;QACjE,GAAG,CAAC,CAAC,CAACC,cAAc,GAAEC,cAAc,GAAEC,kBAAkB,EAAC,CAAC,GAAGP,SAAS;QAEtEK,cAAc,GAAG,KAAK,CAACA,cAAc;QACrCC,cAAc,GAAG,KAAK,CAACA,cAAc;QACrCC,kBAAkB,GAAG,KAAK,CAACA,kBAAkB;QAC7C,KAAK,CAACC,UAAU,GAAI,KAAK,CAACR,SAAS,CAACS,MAAM,IAAK,CAAC;QAAA,CAAC;QAEjD,MAAM,CAAC,CAAC;YACNT,SAAS;YACTQ,UAAU;YACVH,cAAc;YACdC,cAAc;YACdC,kBAAkB;YAClBR,YAAY,EAAEC,SAAS;QACzB,CAAC;IACH,CAAC;IAED,KAAK,CAACU,WAAW,GAAG,KAAK,KA1EC,QAAW,cA0EC,CAAY,aAAEf,OAAO,EAAES,UAAU;IACvE,KAAK,CAACO,MAAM,GAAG,KAAK,KA3EM,QAAW,cA2EJ,CAAO,QAAEhB,OAAO,EAAES,UAAU;IAC7D,KAAK,CAACL,YAAY,GAAG,KAAK,KA5EA,QAAW,cA4EEI,QAAQ,EAAER,OAAO,EAAES,UAAU;IAEpE,KAAK,EAAEH,aAAa,EAAEC,qBAAqB,EAAEF,SAAS,EAAEJ,QAAQ,EAAEE,GAAG,IACnE,KAAK,CAACc,OAAO,CAACC,GAAG,CAAC,CAAC;QACjBhB,OAAO,KAjFQ,KAAM,OAiFRF,OAAO,EAlFnB,UAAyB;QAmF1BE,OAAO,KAlFQ,KAAM,OAkFRF,OAAO,EAnFnB,UAAyB;QAoF1BL,cAAc,CAACS,YAAY;QAC3BT,cAAc,CAACoB,WAAW;QAC1BpB,cAAc,CAACqB,MAAM;IACvB,CAAC;IAEH,KAAK,CAAC,CAAC,CAACJ,kBAAkB,GAAEF,cAAc,GAAEC,cAAc,EAAC,CAAC,GAAGP,YAAY;IAE3E,MAAM,CAAC,CAAC;QACND,GAAG;QACHF,QAAQ;QACRI,SAAS;QACTC,aAAa;QACbC,qBAAqB;QACrBM,UAAU,EAAET,YAAY,CAACU,MAAM,IAAI,CAAC;QAAA,CAAC;QACrCV,YAAY;QACZQ,kBAAkB;QAClBF,cAAc;QACdC,cAAc;IAChB,CAAC;AACH,CAAC"}