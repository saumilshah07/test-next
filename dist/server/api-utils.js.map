{"version":3,"sources":["../../server/api-utils.ts"],"sourcesContent":["import { IncomingMessage, ServerResponse } from 'http'\nimport { parse } from 'next/dist/compiled/content-type'\nimport { CookieSerializeOptions } from 'next/dist/compiled/cookie'\nimport getRawBody from 'raw-body'\nimport { PageConfig, PreviewData } from 'next/types'\nimport { Stream } from 'stream'\nimport { isResSent, NextApiRequest, NextApiResponse } from '../shared/lib/utils'\nimport { decryptWithSecret, encryptWithSecret } from './crypto-utils'\nimport { interopDefault } from './load-components'\nimport { sendEtagResponse } from './send-payload'\nimport generateETag from 'etag'\n\nexport type NextApiRequestCookies = { [key: string]: string }\nexport type NextApiRequestQuery = { [key: string]: string | string[] }\n\nexport type __ApiPreviewProps = {\n  previewModeId: string\n  previewModeEncryptionKey: string\n  previewModeSigningKey: string\n}\n\nexport async function apiResolver(\n  req: IncomingMessage,\n  res: ServerResponse,\n  query: any,\n  resolverModule: any,\n  apiContext: __ApiPreviewProps,\n  propagateError: boolean,\n  dev?: boolean,\n  page?: string\n): Promise<void> {\n  const apiReq = req as NextApiRequest\n  const apiRes = res as NextApiResponse\n\n  try {\n    if (!resolverModule) {\n      res.statusCode = 404\n      res.end('Not Found')\n      return\n    }\n    const config: PageConfig = resolverModule.config || {}\n    const bodyParser = config.api?.bodyParser !== false\n    const externalResolver = config.api?.externalResolver || false\n\n    // Parsing of cookies\n    setLazyProp({ req: apiReq }, 'cookies', getCookieParser(req.headers))\n    // Parsing query string\n    apiReq.query = query\n    // Parsing preview data\n    setLazyProp({ req: apiReq }, 'previewData', () =>\n      tryGetPreviewData(req, res, apiContext)\n    )\n    // Checking if preview mode is enabled\n    setLazyProp({ req: apiReq }, 'preview', () =>\n      apiReq.previewData !== false ? true : undefined\n    )\n\n    // Parsing of body\n    if (bodyParser && !apiReq.body) {\n      apiReq.body = await parseBody(\n        apiReq,\n        config.api && config.api.bodyParser && config.api.bodyParser.sizeLimit\n          ? config.api.bodyParser.sizeLimit\n          : '1mb'\n      )\n    }\n\n    let contentLength = 0\n    const writeData = apiRes.write\n    const endResponse = apiRes.end\n    apiRes.write = (...args: any[2]) => {\n      contentLength += Buffer.byteLength(args[0])\n      return writeData.apply(apiRes, args)\n    }\n    apiRes.end = (...args: any[2]) => {\n      if (args.length && typeof args[0] !== 'function') {\n        contentLength += Buffer.byteLength(args[0])\n      }\n\n      if (contentLength >= 4 * 1024 * 1024) {\n        console.warn(\n          `API response for ${req.url} exceeds 4MB. This will cause the request to fail in a future version. https://nextjs.org/docs/messages/api-routes-body-size-limit`\n        )\n      }\n\n      endResponse.apply(apiRes, args)\n    }\n    apiRes.status = (statusCode) => sendStatusCode(apiRes, statusCode)\n    apiRes.send = (data) => sendData(apiReq, apiRes, data)\n    apiRes.json = (data) => sendJson(apiRes, data)\n    apiRes.redirect = (statusOrUrl: number | string, url?: string) =>\n      redirect(apiRes, statusOrUrl, url)\n    apiRes.setPreviewData = (data, options = {}) =>\n      setPreviewData(apiRes, data, Object.assign({}, apiContext, options))\n    apiRes.clearPreviewData = () => clearPreviewData(apiRes)\n\n    const resolver = interopDefault(resolverModule)\n    let wasPiped = false\n\n    if (process.env.NODE_ENV !== 'production') {\n      // listen for pipe event and don't show resolve warning\n      res.once('pipe', () => (wasPiped = true))\n    }\n\n    // Call API route method\n    await resolver(req, res)\n\n    if (\n      process.env.NODE_ENV !== 'production' &&\n      !externalResolver &&\n      !isResSent(res) &&\n      !wasPiped\n    ) {\n      console.warn(\n        `API resolved without sending a response for ${req.url}, this may result in stalled requests.`\n      )\n    }\n  } catch (err) {\n    if (err instanceof ApiError) {\n      sendError(apiRes, err.statusCode, err.message)\n    } else {\n      if (dev) {\n        if (err) {\n          err.page = page\n        }\n        throw err\n      }\n\n      console.error(err)\n      if (propagateError) {\n        throw err\n      }\n      sendError(apiRes, 500, 'Internal Server Error')\n    }\n  }\n}\n\n/**\n * Parse incoming message like `json` or `urlencoded`\n * @param req request object\n */\nexport async function parseBody(\n  req: NextApiRequest,\n  limit: string | number\n): Promise<any> {\n  let contentType\n  try {\n    contentType = parse(req.headers['content-type'] || 'text/plain')\n  } catch {\n    contentType = parse('text/plain')\n  }\n  const { type, parameters } = contentType\n  const encoding = parameters.charset || 'utf-8'\n\n  let buffer\n\n  try {\n    buffer = await getRawBody(req, { encoding, limit })\n  } catch (e) {\n    if (e.type === 'entity.too.large') {\n      throw new ApiError(413, `Body exceeded ${limit} limit`)\n    } else {\n      throw new ApiError(400, 'Invalid body')\n    }\n  }\n\n  const body = buffer.toString()\n\n  if (type === 'application/json' || type === 'application/ld+json') {\n    return parseJson(body)\n  } else if (type === 'application/x-www-form-urlencoded') {\n    const qs = require('querystring')\n    return qs.decode(body)\n  } else {\n    return body\n  }\n}\n\n/**\n * Parse `JSON` and handles invalid `JSON` strings\n * @param str `JSON` string\n */\nfunction parseJson(str: string): object {\n  if (str.length === 0) {\n    // special-case empty json body, as it's a common client-side mistake\n    return {}\n  }\n\n  try {\n    return JSON.parse(str)\n  } catch (e) {\n    throw new ApiError(400, 'Invalid JSON')\n  }\n}\n\n/**\n * Parse cookies from the `headers` of request\n * @param req request object\n */\nexport function getCookieParser(headers: {\n  [key: string]: undefined | string | string[]\n}): () => NextApiRequestCookies {\n  return function parseCookie(): NextApiRequestCookies {\n    const header: undefined | string | string[] = headers.cookie\n\n    if (!header) {\n      return {}\n    }\n\n    const { parse: parseCookieFn } = require('next/dist/compiled/cookie')\n    return parseCookieFn(Array.isArray(header) ? header.join(';') : header)\n  }\n}\n\n/**\n *\n * @param res response object\n * @param statusCode `HTTP` status code of response\n */\nexport function sendStatusCode(\n  res: NextApiResponse,\n  statusCode: number\n): NextApiResponse<any> {\n  res.statusCode = statusCode\n  return res\n}\n\n/**\n *\n * @param res response object\n * @param [statusOrUrl] `HTTP` status code of redirect\n * @param url URL of redirect\n */\nexport function redirect(\n  res: NextApiResponse,\n  statusOrUrl: string | number,\n  url?: string\n): NextApiResponse<any> {\n  if (typeof statusOrUrl === 'string') {\n    url = statusOrUrl\n    statusOrUrl = 307\n  }\n  if (typeof statusOrUrl !== 'number' || typeof url !== 'string') {\n    throw new Error(\n      `Invalid redirect arguments. Please use a single argument URL, e.g. res.redirect('/destination') or use a status code and URL, e.g. res.redirect(307, '/destination').`\n    )\n  }\n  res.writeHead(statusOrUrl, { Location: url })\n  res.write(url)\n  res.end()\n  return res\n}\n\n/**\n * Send `any` body to response\n * @param req request object\n * @param res response object\n * @param body of response\n */\nexport function sendData(\n  req: NextApiRequest,\n  res: NextApiResponse,\n  body: any\n): void {\n  if (body === null || body === undefined) {\n    res.end()\n    return\n  }\n\n  // strip irrelevant headers/body\n  if (res.statusCode === 204 || res.statusCode === 304) {\n    res.removeHeader('Content-Type')\n    res.removeHeader('Content-Length')\n    res.removeHeader('Transfer-Encoding')\n\n    if (process.env.NODE_ENV === 'development' && body) {\n      console.warn(\n        `A body was attempted to be set with a 204 statusCode for ${req.url}, this is invalid and the body was ignored.\\n` +\n          `See more info here https://nextjs.org/docs/messages/invalid-api-status-body`\n      )\n    }\n    res.end()\n    return\n  }\n\n  const contentType = res.getHeader('Content-Type')\n\n  if (body instanceof Stream) {\n    if (!contentType) {\n      res.setHeader('Content-Type', 'application/octet-stream')\n    }\n    body.pipe(res)\n    return\n  }\n\n  const isJSONLike = ['object', 'number', 'boolean'].includes(typeof body)\n  const stringifiedBody = isJSONLike ? JSON.stringify(body) : body\n  const etag = generateETag(stringifiedBody)\n  if (sendEtagResponse(req, res, etag)) {\n    return\n  }\n\n  if (Buffer.isBuffer(body)) {\n    if (!contentType) {\n      res.setHeader('Content-Type', 'application/octet-stream')\n    }\n    res.setHeader('Content-Length', body.length)\n    res.end(body)\n    return\n  }\n\n  if (isJSONLike) {\n    res.setHeader('Content-Type', 'application/json; charset=utf-8')\n  }\n\n  res.setHeader('Content-Length', Buffer.byteLength(stringifiedBody))\n  res.end(stringifiedBody)\n}\n\n/**\n * Send `JSON` object\n * @param res response object\n * @param jsonBody of data\n */\nexport function sendJson(res: NextApiResponse, jsonBody: any): void {\n  // Set header to application/json\n  res.setHeader('Content-Type', 'application/json; charset=utf-8')\n\n  // Use send to handle request\n  res.send(jsonBody)\n}\n\nconst COOKIE_NAME_PRERENDER_BYPASS = `__prerender_bypass`\nconst COOKIE_NAME_PRERENDER_DATA = `__next_preview_data`\n\nexport const SYMBOL_PREVIEW_DATA = Symbol(COOKIE_NAME_PRERENDER_DATA)\nconst SYMBOL_CLEARED_COOKIES = Symbol(COOKIE_NAME_PRERENDER_BYPASS)\n\nexport function tryGetPreviewData(\n  req: IncomingMessage,\n  res: ServerResponse,\n  options: __ApiPreviewProps\n): PreviewData {\n  // Read cached preview data if present\n  if (SYMBOL_PREVIEW_DATA in req) {\n    return (req as any)[SYMBOL_PREVIEW_DATA] as any\n  }\n\n  const getCookies = getCookieParser(req.headers)\n  let cookies: NextApiRequestCookies\n  try {\n    cookies = getCookies()\n  } catch {\n    // TODO: warn\n    return false\n  }\n\n  const hasBypass = COOKIE_NAME_PRERENDER_BYPASS in cookies\n  const hasData = COOKIE_NAME_PRERENDER_DATA in cookies\n\n  // Case: neither cookie is set.\n  if (!(hasBypass || hasData)) {\n    return false\n  }\n\n  // Case: one cookie is set, but not the other.\n  if (hasBypass !== hasData) {\n    clearPreviewData(res as NextApiResponse)\n    return false\n  }\n\n  // Case: preview session is for an old build.\n  if (cookies[COOKIE_NAME_PRERENDER_BYPASS] !== options.previewModeId) {\n    clearPreviewData(res as NextApiResponse)\n    return false\n  }\n\n  const tokenPreviewData = cookies[COOKIE_NAME_PRERENDER_DATA]\n\n  const jsonwebtoken =\n    require('next/dist/compiled/jsonwebtoken') as typeof import('jsonwebtoken')\n  let encryptedPreviewData: {\n    data: string\n  }\n  try {\n    encryptedPreviewData = jsonwebtoken.verify(\n      tokenPreviewData,\n      options.previewModeSigningKey\n    ) as typeof encryptedPreviewData\n  } catch {\n    // TODO: warn\n    clearPreviewData(res as NextApiResponse)\n    return false\n  }\n\n  const decryptedPreviewData = decryptWithSecret(\n    Buffer.from(options.previewModeEncryptionKey),\n    encryptedPreviewData.data\n  )\n\n  try {\n    // TODO: strict runtime type checking\n    const data = JSON.parse(decryptedPreviewData)\n    // Cache lookup\n    Object.defineProperty(req, SYMBOL_PREVIEW_DATA, {\n      value: data,\n      enumerable: false,\n    })\n    return data\n  } catch {\n    return false\n  }\n}\n\nfunction isNotValidData(str: string): boolean {\n  return typeof str !== 'string' || str.length < 16\n}\n\nfunction setPreviewData<T>(\n  res: NextApiResponse<T>,\n  data: object | string, // TODO: strict runtime type checking\n  options: {\n    maxAge?: number\n  } & __ApiPreviewProps\n): NextApiResponse<T> {\n  if (isNotValidData(options.previewModeId)) {\n    throw new Error('invariant: invalid previewModeId')\n  }\n  if (isNotValidData(options.previewModeEncryptionKey)) {\n    throw new Error('invariant: invalid previewModeEncryptionKey')\n  }\n  if (isNotValidData(options.previewModeSigningKey)) {\n    throw new Error('invariant: invalid previewModeSigningKey')\n  }\n\n  const jsonwebtoken =\n    require('next/dist/compiled/jsonwebtoken') as typeof import('jsonwebtoken')\n\n  const payload = jsonwebtoken.sign(\n    {\n      data: encryptWithSecret(\n        Buffer.from(options.previewModeEncryptionKey),\n        JSON.stringify(data)\n      ),\n    },\n    options.previewModeSigningKey,\n    {\n      algorithm: 'HS256',\n      ...(options.maxAge !== undefined\n        ? { expiresIn: options.maxAge }\n        : undefined),\n    }\n  )\n\n  // limit preview mode cookie to 2KB since we shouldn't store too much\n  // data here and browsers drop cookies over 4KB\n  if (payload.length > 2048) {\n    throw new Error(\n      `Preview data is limited to 2KB currently, reduce how much data you are storing as preview data to continue`\n    )\n  }\n\n  const { serialize } =\n    require('next/dist/compiled/cookie') as typeof import('cookie')\n  const previous = res.getHeader('Set-Cookie')\n  res.setHeader(`Set-Cookie`, [\n    ...(typeof previous === 'string'\n      ? [previous]\n      : Array.isArray(previous)\n      ? previous\n      : []),\n    serialize(COOKIE_NAME_PRERENDER_BYPASS, options.previewModeId, {\n      httpOnly: true,\n      sameSite: process.env.NODE_ENV !== 'development' ? 'none' : 'lax',\n      secure: process.env.NODE_ENV !== 'development',\n      path: '/',\n      ...(options.maxAge !== undefined\n        ? ({ maxAge: options.maxAge } as CookieSerializeOptions)\n        : undefined),\n    }),\n    serialize(COOKIE_NAME_PRERENDER_DATA, payload, {\n      httpOnly: true,\n      sameSite: process.env.NODE_ENV !== 'development' ? 'none' : 'lax',\n      secure: process.env.NODE_ENV !== 'development',\n      path: '/',\n      ...(options.maxAge !== undefined\n        ? ({ maxAge: options.maxAge } as CookieSerializeOptions)\n        : undefined),\n    }),\n  ])\n  return res\n}\n\nfunction clearPreviewData<T>(res: NextApiResponse<T>): NextApiResponse<T> {\n  if (SYMBOL_CLEARED_COOKIES in res) {\n    return res\n  }\n\n  const { serialize } =\n    require('next/dist/compiled/cookie') as typeof import('cookie')\n  const previous = res.getHeader('Set-Cookie')\n  res.setHeader(`Set-Cookie`, [\n    ...(typeof previous === 'string'\n      ? [previous]\n      : Array.isArray(previous)\n      ? previous\n      : []),\n    serialize(COOKIE_NAME_PRERENDER_BYPASS, '', {\n      // To delete a cookie, set `expires` to a date in the past:\n      // https://tools.ietf.org/html/rfc6265#section-4.1.1\n      // `Max-Age: 0` is not valid, thus ignored, and the cookie is persisted.\n      expires: new Date(0),\n      httpOnly: true,\n      sameSite: process.env.NODE_ENV !== 'development' ? 'none' : 'lax',\n      secure: process.env.NODE_ENV !== 'development',\n      path: '/',\n    }),\n    serialize(COOKIE_NAME_PRERENDER_DATA, '', {\n      // To delete a cookie, set `expires` to a date in the past:\n      // https://tools.ietf.org/html/rfc6265#section-4.1.1\n      // `Max-Age: 0` is not valid, thus ignored, and the cookie is persisted.\n      expires: new Date(0),\n      httpOnly: true,\n      sameSite: process.env.NODE_ENV !== 'development' ? 'none' : 'lax',\n      secure: process.env.NODE_ENV !== 'development',\n      path: '/',\n    }),\n  ])\n\n  Object.defineProperty(res, SYMBOL_CLEARED_COOKIES, {\n    value: true,\n    enumerable: false,\n  })\n  return res\n}\n\n/**\n * Custom error class\n */\nexport class ApiError extends Error {\n  readonly statusCode: number\n\n  constructor(statusCode: number, message: string) {\n    super(message)\n    this.statusCode = statusCode\n  }\n}\n\n/**\n * Sends error in `response`\n * @param res response object\n * @param statusCode of response\n * @param message of response\n */\nexport function sendError(\n  res: NextApiResponse,\n  statusCode: number,\n  message: string\n): void {\n  res.statusCode = statusCode\n  res.statusMessage = message\n  res.end(message)\n}\n\ninterface LazyProps {\n  req: NextApiRequest\n}\n\n/**\n * Execute getter function only if its needed\n * @param LazyProps `req` and `params` for lazyProp\n * @param prop name of property\n * @param getter function to get data\n */\nexport function setLazyProp<T>(\n  { req }: LazyProps,\n  prop: string,\n  getter: () => T\n): void {\n  const opts = { configurable: true, enumerable: true }\n  const optsReset = { ...opts, writable: true }\n\n  Object.defineProperty(req, prop, {\n    ...opts,\n    get: () => {\n      const value = getter()\n      // we set the property on the object to avoid recalculating it\n      Object.defineProperty(req, prop, { ...optsReset, value })\n      return value\n    },\n    set: (value) => {\n      Object.defineProperty(req, prop, { ...optsReset, value })\n    },\n  })\n}\n"],"names":["apiResolver","parseBody","getCookieParser","sendStatusCode","redirect","sendData","sendJson","tryGetPreviewData","sendError","setLazyProp","req","res","query","resolverModule","apiContext","propagateError","dev","page","apiReq","apiRes","config","statusCode","end","bodyParser","api","externalResolver","headers","previewData","undefined","body","sizeLimit","contentLength","writeData","write","endResponse","args","Buffer","byteLength","apply","length","console","warn","url","status","send","data","json","statusOrUrl","setPreviewData","options","Object","assign","clearPreviewData","resolver","wasPiped","process","env","NODE_ENV","once","err","ApiError","message","error","limit","contentType","type","parameters","encoding","charset","buffer","e","toString","parseJson","qs","require","decode","str","JSON","parse","parseCookie","header","cookie","parseCookieFn","Array","isArray","join","Error","writeHead","Location","removeHeader","getHeader","setHeader","pipe","isJSONLike","includes","stringifiedBody","stringify","etag","isBuffer","jsonBody","COOKIE_NAME_PRERENDER_BYPASS","COOKIE_NAME_PRERENDER_DATA","SYMBOL_PREVIEW_DATA","Symbol","SYMBOL_CLEARED_COOKIES","getCookies","cookies","hasBypass","hasData","previewModeId","tokenPreviewData","jsonwebtoken","encryptedPreviewData","verify","previewModeSigningKey","decryptedPreviewData","from","previewModeEncryptionKey","defineProperty","value","enumerable","isNotValidData","payload","sign","algorithm","maxAge","expiresIn","serialize","previous","httpOnly","sameSite","secure","path","expires","Date","statusMessage","prop","getter","opts","configurable","optsReset","writable","get","set"],"mappings":"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"}