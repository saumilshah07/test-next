{"version":3,"sources":["../../server/image-optimizer.ts"],"sourcesContent":["import { mediaType } from '@hapi/accept'\nimport { createHash } from 'crypto'\nimport { createReadStream, promises } from 'fs'\nimport { getOrientation, Orientation } from 'get-orientation'\nimport { IncomingMessage, ServerResponse } from 'http'\n// @ts-ignore no types for is-animated\nimport isAnimated from 'next/dist/compiled/is-animated'\nimport { join } from 'path'\nimport Stream from 'stream'\nimport nodeUrl, { UrlWithParsedQuery } from 'url'\nimport { NextConfig } from './config-shared'\nimport { fileExists } from '../lib/file-exists'\nimport { ImageConfig, imageConfigDefault } from './image-config'\nimport { processBuffer, Operation } from './lib/squoosh/main'\nimport Server from './next-server'\nimport { sendEtagResponse } from './send-payload'\nimport { getContentType, getExtension } from './serve-static'\nimport chalk from 'chalk'\n\n//const AVIF = 'image/avif'\nconst WEBP = 'image/webp'\nconst PNG = 'image/png'\nconst JPEG = 'image/jpeg'\nconst GIF = 'image/gif'\nconst SVG = 'image/svg+xml'\nconst CACHE_VERSION = 3\nconst MODERN_TYPES = [/* AVIF, */ WEBP]\nconst ANIMATABLE_TYPES = [WEBP, PNG, GIF]\nconst VECTOR_TYPES = [SVG]\nconst BLUR_IMG_SIZE = 8 // should match `next-image-loader`\nconst inflightRequests = new Map<string, Promise<undefined>>()\n\nlet sharp:\n  | ((\n      input?: string | Buffer,\n      options?: import('sharp').SharpOptions\n    ) => import('sharp').Sharp)\n  | undefined\n\ntry {\n  sharp = require(process.env.NEXT_SHARP_PATH || 'sharp')\n} catch (e) {\n  // Sharp not present on the server, Squoosh fallback will be used\n}\n\nlet shouldShowSharpWarning = process.env.NODE_ENV === 'production'\n\nexport async function imageOptimizer(\n  server: Server,\n  req: IncomingMessage,\n  res: ServerResponse,\n  parsedUrl: UrlWithParsedQuery,\n  nextConfig: NextConfig,\n  distDir: string,\n  isDev = false\n) {\n  const imageData: ImageConfig = nextConfig.images || imageConfigDefault\n  const {\n    deviceSizes = [],\n    imageSizes = [],\n    domains = [],\n    loader,\n    minimumCacheTTL = 60,\n  } = imageData\n\n  if (loader !== 'default') {\n    await server.render404(req, res, parsedUrl)\n    return { finished: true }\n  }\n\n  const { headers } = req\n  const { url, w, q } = parsedUrl.query\n  const mimeType = getSupportedMimeType(MODERN_TYPES, headers.accept)\n  let href: string\n\n  if (!url) {\n    res.statusCode = 400\n    res.end('\"url\" parameter is required')\n    return { finished: true }\n  } else if (Array.isArray(url)) {\n    res.statusCode = 400\n    res.end('\"url\" parameter cannot be an array')\n    return { finished: true }\n  }\n\n  let isAbsolute: boolean\n\n  if (url.startsWith('/')) {\n    href = url\n    isAbsolute = false\n  } else {\n    let hrefParsed: URL\n\n    try {\n      hrefParsed = new URL(url)\n      href = hrefParsed.toString()\n      isAbsolute = true\n    } catch (_error) {\n      res.statusCode = 400\n      res.end('\"url\" parameter is invalid')\n      return { finished: true }\n    }\n\n    if (!['http:', 'https:'].includes(hrefParsed.protocol)) {\n      res.statusCode = 400\n      res.end('\"url\" parameter is invalid')\n      return { finished: true }\n    }\n\n    if (!domains.includes(hrefParsed.hostname)) {\n      res.statusCode = 400\n      res.end('\"url\" parameter is not allowed')\n      return { finished: true }\n    }\n  }\n\n  if (!w) {\n    res.statusCode = 400\n    res.end('\"w\" parameter (width) is required')\n    return { finished: true }\n  } else if (Array.isArray(w)) {\n    res.statusCode = 400\n    res.end('\"w\" parameter (width) cannot be an array')\n    return { finished: true }\n  }\n\n  if (!q) {\n    res.statusCode = 400\n    res.end('\"q\" parameter (quality) is required')\n    return { finished: true }\n  } else if (Array.isArray(q)) {\n    res.statusCode = 400\n    res.end('\"q\" parameter (quality) cannot be an array')\n    return { finished: true }\n  }\n\n  // Should match output from next-image-loader\n  const isStatic = url.startsWith('/_next/static/image')\n\n  const width = parseInt(w, 10)\n\n  if (!width || isNaN(width)) {\n    res.statusCode = 400\n    res.end('\"w\" parameter (width) must be a number greater than 0')\n    return { finished: true }\n  }\n\n  const sizes = [...deviceSizes, ...imageSizes]\n\n  if (isDev) {\n    sizes.push(BLUR_IMG_SIZE)\n  }\n\n  if (!sizes.includes(width)) {\n    res.statusCode = 400\n    res.end(`\"w\" parameter (width) of ${width} is not allowed`)\n    return { finished: true }\n  }\n\n  const quality = parseInt(q)\n\n  if (isNaN(quality) || quality < 1 || quality > 100) {\n    res.statusCode = 400\n    res.end('\"q\" parameter (quality) must be a number between 1 and 100')\n    return { finished: true }\n  }\n\n  const hash = getHash([CACHE_VERSION, href, width, quality, mimeType])\n  const imagesDir = join(distDir, 'cache', 'images')\n  const hashDir = join(imagesDir, hash)\n  const now = Date.now()\n\n  // If there're concurrent requests hitting the same resource and it's still\n  // being optimized, wait before accessing the cache.\n  if (inflightRequests.has(hash)) {\n    await inflightRequests.get(hash)\n  }\n  let dedupeResolver: (val?: PromiseLike<undefined>) => void\n  inflightRequests.set(\n    hash,\n    new Promise((resolve) => (dedupeResolver = resolve))\n  )\n\n  try {\n    if (await fileExists(hashDir, 'directory')) {\n      const files = await promises.readdir(hashDir)\n      for (let file of files) {\n        const [maxAgeStr, expireAtSt, etag, extension] = file.split('.')\n        const maxAge = Number(maxAgeStr)\n        const expireAt = Number(expireAtSt)\n        const contentType = getContentType(extension)\n        const fsPath = join(hashDir, file)\n        if (now < expireAt) {\n          const result = setResponseHeaders(\n            req,\n            res,\n            url,\n            etag,\n            maxAge,\n            contentType,\n            isStatic,\n            isDev\n          )\n          if (!result.finished) {\n            createReadStream(fsPath).pipe(res)\n          }\n          return { finished: true }\n        } else {\n          await promises.unlink(fsPath)\n        }\n      }\n    }\n\n    let upstreamBuffer: Buffer\n    let upstreamType: string | null\n    let maxAge: number\n\n    if (isAbsolute) {\n      const upstreamRes = await fetch(href)\n\n      if (!upstreamRes.ok) {\n        res.statusCode = upstreamRes.status\n        res.end('\"url\" parameter is valid but upstream response is invalid')\n        return { finished: true }\n      }\n\n      res.statusCode = upstreamRes.status\n      upstreamBuffer = Buffer.from(await upstreamRes.arrayBuffer())\n      upstreamType =\n        detectContentType(upstreamBuffer) ||\n        upstreamRes.headers.get('Content-Type')\n      maxAge = getMaxAge(upstreamRes.headers.get('Cache-Control'))\n    } else {\n      try {\n        const resBuffers: Buffer[] = []\n        const mockRes: any = new Stream.Writable()\n\n        const isStreamFinished = new Promise(function (resolve, reject) {\n          mockRes.on('finish', () => resolve(true))\n          mockRes.on('end', () => resolve(true))\n          mockRes.on('error', () => reject())\n        })\n\n        mockRes.write = (chunk: Buffer | string) => {\n          resBuffers.push(Buffer.isBuffer(chunk) ? chunk : Buffer.from(chunk))\n        }\n        mockRes._write = (chunk: Buffer | string) => {\n          mockRes.write(chunk)\n        }\n\n        const mockHeaders: Record<string, string | string[]> = {}\n\n        mockRes.writeHead = (_status: any, _headers: any) =>\n          Object.assign(mockHeaders, _headers)\n        mockRes.getHeader = (name: string) => mockHeaders[name.toLowerCase()]\n        mockRes.getHeaders = () => mockHeaders\n        mockRes.getHeaderNames = () => Object.keys(mockHeaders)\n        mockRes.setHeader = (name: string, value: string | string[]) =>\n          (mockHeaders[name.toLowerCase()] = value)\n        mockRes.removeHeader = (name: string) => {\n          delete mockHeaders[name.toLowerCase()]\n        }\n        mockRes._implicitHeader = () => {}\n        mockRes.connection = res.connection\n        mockRes.finished = false\n        mockRes.statusCode = 200\n\n        const mockReq: any = new Stream.Readable()\n\n        mockReq._read = () => {\n          mockReq.emit('end')\n          mockReq.emit('close')\n          return Buffer.from('')\n        }\n\n        mockReq.headers = req.headers\n        mockReq.method = req.method\n        mockReq.url = href\n        mockReq.connection = req.connection\n\n        await server.getRequestHandler()(\n          mockReq,\n          mockRes,\n          nodeUrl.parse(href, true)\n        )\n        await isStreamFinished\n        res.statusCode = mockRes.statusCode\n\n        upstreamBuffer = Buffer.concat(resBuffers)\n        upstreamType =\n          detectContentType(upstreamBuffer) || mockRes.getHeader('Content-Type')\n        maxAge = getMaxAge(mockRes.getHeader('Cache-Control'))\n      } catch (err) {\n        res.statusCode = 500\n        res.end('\"url\" parameter is valid but upstream response is invalid')\n        return { finished: true }\n      }\n    }\n\n    const expireAt = Math.max(maxAge, minimumCacheTTL) * 1000 + now\n\n    if (upstreamType) {\n      const vector = VECTOR_TYPES.includes(upstreamType)\n      const animate =\n        ANIMATABLE_TYPES.includes(upstreamType) && isAnimated(upstreamBuffer)\n      if (vector || animate) {\n        await writeToCacheDir(\n          hashDir,\n          upstreamType,\n          maxAge,\n          expireAt,\n          upstreamBuffer\n        )\n        sendResponse(\n          req,\n          res,\n          url,\n          maxAge,\n          upstreamType,\n          upstreamBuffer,\n          isStatic,\n          isDev\n        )\n        return { finished: true }\n      }\n\n      if (!upstreamType.startsWith('image/')) {\n        res.statusCode = 400\n        res.end(\"The requested resource isn't a valid image.\")\n        return { finished: true }\n      }\n    }\n\n    let contentType: string\n\n    if (mimeType) {\n      contentType = mimeType\n    } else if (\n      upstreamType?.startsWith('image/') &&\n      getExtension(upstreamType)\n    ) {\n      contentType = upstreamType\n    } else {\n      contentType = JPEG\n    }\n    try {\n      let optimizedBuffer: Buffer | undefined\n      if (sharp) {\n        // Begin sharp transformation logic\n        const transformer = sharp(upstreamBuffer)\n\n        transformer.rotate()\n\n        const { width: metaWidth } = await transformer.metadata()\n\n        if (metaWidth && metaWidth > width) {\n          transformer.resize(width)\n        }\n\n        if (contentType === WEBP) {\n          transformer.webp({ quality })\n        } else if (contentType === PNG) {\n          transformer.png({ quality })\n        } else if (contentType === JPEG) {\n          transformer.jpeg({ quality })\n        }\n\n        optimizedBuffer = await transformer.toBuffer()\n        // End sharp transformation logic\n      } else {\n        // Show sharp warning in production once\n        if (shouldShowSharpWarning) {\n          console.warn(\n            chalk.yellow.bold('Warning: ') +\n              `For production Image Optimization with Next.js, the optional 'sharp' package is strongly recommended. Run 'yarn add sharp', and Next.js will use it automatically for Image Optimization.\\n` +\n              'Read more: https://nextjs.org/docs/messages/sharp-missing-in-production'\n          )\n          shouldShowSharpWarning = false\n        }\n\n        // Begin Squoosh transformation logic\n        const orientation = await getOrientation(upstreamBuffer)\n\n        const operations: Operation[] = []\n\n        if (orientation === Orientation.RIGHT_TOP) {\n          operations.push({ type: 'rotate', numRotations: 1 })\n        } else if (orientation === Orientation.BOTTOM_RIGHT) {\n          operations.push({ type: 'rotate', numRotations: 2 })\n        } else if (orientation === Orientation.LEFT_BOTTOM) {\n          operations.push({ type: 'rotate', numRotations: 3 })\n        } else {\n          // TODO: support more orientations\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n          // const _: never = orientation\n        }\n\n        operations.push({ type: 'resize', width })\n\n        //if (contentType === AVIF) {\n        //} else\n        if (contentType === WEBP) {\n          optimizedBuffer = await processBuffer(\n            upstreamBuffer,\n            operations,\n            'webp',\n            quality\n          )\n        } else if (contentType === PNG) {\n          optimizedBuffer = await processBuffer(\n            upstreamBuffer,\n            operations,\n            'png',\n            quality\n          )\n        } else if (contentType === JPEG) {\n          optimizedBuffer = await processBuffer(\n            upstreamBuffer,\n            operations,\n            'jpeg',\n            quality\n          )\n        }\n\n        // End Squoosh transformation logic\n      }\n      if (optimizedBuffer) {\n        await writeToCacheDir(\n          hashDir,\n          contentType,\n          maxAge,\n          expireAt,\n          optimizedBuffer\n        )\n        sendResponse(\n          req,\n          res,\n          url,\n          maxAge,\n          contentType,\n          optimizedBuffer,\n          isStatic,\n          isDev\n        )\n      } else {\n        throw new Error('Unable to optimize buffer')\n      }\n    } catch (error) {\n      sendResponse(\n        req,\n        res,\n        url,\n        maxAge,\n        upstreamType,\n        upstreamBuffer,\n        isStatic,\n        isDev\n      )\n    }\n\n    return { finished: true }\n  } finally {\n    // Make sure to remove the hash in the end.\n    dedupeResolver!()\n    inflightRequests.delete(hash)\n  }\n}\n\nasync function writeToCacheDir(\n  dir: string,\n  contentType: string,\n  maxAge: number,\n  expireAt: number,\n  buffer: Buffer\n) {\n  await promises.mkdir(dir, { recursive: true })\n  const extension = getExtension(contentType)\n  const etag = getHash([buffer])\n  const filename = join(dir, `${maxAge}.${expireAt}.${etag}.${extension}`)\n  await promises.writeFile(filename, buffer)\n}\n\nfunction getFileNameWithExtension(\n  url: string,\n  contentType: string | null\n): string | void {\n  const [urlWithoutQueryParams] = url.split('?')\n  const fileNameWithExtension = urlWithoutQueryParams.split('/').pop()\n  if (!contentType || !fileNameWithExtension) {\n    return\n  }\n\n  const [fileName] = fileNameWithExtension.split('.')\n  const extension = getExtension(contentType)\n  return `${fileName}.${extension}`\n}\n\nfunction setResponseHeaders(\n  req: IncomingMessage,\n  res: ServerResponse,\n  url: string,\n  etag: string,\n  maxAge: number,\n  contentType: string | null,\n  isStatic: boolean,\n  isDev: boolean\n) {\n  res.setHeader('Vary', 'Accept')\n  res.setHeader(\n    'Cache-Control',\n    isStatic\n      ? 'public, max-age=315360000, immutable'\n      : `public, max-age=${isDev ? 0 : maxAge}, must-revalidate`\n  )\n  if (sendEtagResponse(req, res, etag)) {\n    // already called res.end() so we're finished\n    return { finished: true }\n  }\n  if (contentType) {\n    res.setHeader('Content-Type', contentType)\n  }\n\n  const fileName = getFileNameWithExtension(url, contentType)\n  if (fileName) {\n    res.setHeader('Content-Disposition', `inline; filename=\"${fileName}\"`)\n  }\n\n  res.setHeader('Content-Security-Policy', `script-src 'none'; sandbox;`)\n\n  return { finished: false }\n}\n\nfunction sendResponse(\n  req: IncomingMessage,\n  res: ServerResponse,\n  url: string,\n  maxAge: number,\n  contentType: string | null,\n  buffer: Buffer,\n  isStatic: boolean,\n  isDev: boolean\n) {\n  const etag = getHash([buffer])\n  const result = setResponseHeaders(\n    req,\n    res,\n    url,\n    etag,\n    maxAge,\n    contentType,\n    isStatic,\n    isDev\n  )\n  if (!result.finished) {\n    res.end(buffer)\n  }\n}\n\nfunction getSupportedMimeType(options: string[], accept = ''): string {\n  const mimeType = mediaType(accept, options)\n  return accept.includes(mimeType) ? mimeType : ''\n}\n\nfunction getHash(items: (string | number | Buffer)[]) {\n  const hash = createHash('sha256')\n  for (let item of items) {\n    if (typeof item === 'number') hash.update(String(item))\n    else {\n      hash.update(item)\n    }\n  }\n  // See https://en.wikipedia.org/wiki/Base64#Filenames\n  return hash.digest('base64').replace(/\\//g, '-')\n}\n\nfunction parseCacheControl(str: string | null): Map<string, string> {\n  const map = new Map<string, string>()\n  if (!str) {\n    return map\n  }\n  for (let directive of str.split(',')) {\n    let [key, value] = directive.trim().split('=')\n    key = key.toLowerCase()\n    if (value) {\n      value = value.toLowerCase()\n    }\n    map.set(key, value)\n  }\n  return map\n}\n\n/**\n * Inspects the first few bytes of a buffer to determine if\n * it matches the \"magic number\" of known file signatures.\n * https://en.wikipedia.org/wiki/List_of_file_signatures\n */\nexport function detectContentType(buffer: Buffer) {\n  if ([0xff, 0xd8, 0xff].every((b, i) => buffer[i] === b)) {\n    return JPEG\n  }\n  if (\n    [0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a].every(\n      (b, i) => buffer[i] === b\n    )\n  ) {\n    return PNG\n  }\n  if ([0x47, 0x49, 0x46, 0x38].every((b, i) => buffer[i] === b)) {\n    return GIF\n  }\n  if (\n    [0x52, 0x49, 0x46, 0x46, 0, 0, 0, 0, 0x57, 0x45, 0x42, 0x50].every(\n      (b, i) => !b || buffer[i] === b\n    )\n  ) {\n    return WEBP\n  }\n  if ([0x3c, 0x3f, 0x78, 0x6d, 0x6c].every((b, i) => buffer[i] === b)) {\n    return SVG\n  }\n  return null\n}\n\nexport function getMaxAge(str: string | null): number {\n  const map = parseCacheControl(str)\n  if (map) {\n    let age = map.get('s-maxage') || map.get('max-age') || ''\n    if (age.startsWith('\"') && age.endsWith('\"')) {\n      age = age.slice(1, -1)\n    }\n    const n = parseInt(age, 10)\n    if (!isNaN(n)) {\n      return n\n    }\n  }\n  return 0\n}\n\nexport async function resizeImage(\n  content: Buffer,\n  dimension: 'width' | 'height',\n  size: number,\n  extension: 'webp' | 'png' | 'jpeg',\n  quality: number\n): Promise<Buffer> {\n  if (sharp) {\n    const transformer = sharp(content)\n\n    if (extension === 'webp') {\n      transformer.webp({ quality })\n    } else if (extension === 'png') {\n      transformer.png({ quality })\n    } else if (extension === 'jpeg') {\n      transformer.jpeg({ quality })\n    }\n    if (dimension === 'width') {\n      transformer.resize(size)\n    } else {\n      transformer.resize(null, size)\n    }\n    const buf = await transformer.toBuffer()\n    return buf\n  } else {\n    const resizeOperationOpts: Operation =\n      dimension === 'width'\n        ? { type: 'resize', width: size }\n        : { type: 'resize', height: size }\n    const buf = await processBuffer(\n      content,\n      [resizeOperationOpts],\n      extension,\n      quality\n    )\n    return buf\n  }\n}\n"],"names":["imageOptimizer","detectContentType","getMaxAge","resizeImage","WEBP","PNG","JPEG","GIF","SVG","CACHE_VERSION","MODERN_TYPES","ANIMATABLE_TYPES","VECTOR_TYPES","BLUR_IMG_SIZE","inflightRequests","Map","sharp","require","process","env","NEXT_SHARP_PATH","e","shouldShowSharpWarning","NODE_ENV","server","req","res","parsedUrl","nextConfig","distDir","isDev","imageData","images","deviceSizes","imageSizes","domains","loader","minimumCacheTTL","render404","finished","headers","url","w","q","query","mimeType","getSupportedMimeType","accept","href","statusCode","end","Array","isArray","isAbsolute","startsWith","hrefParsed","URL","toString","_error","includes","protocol","hostname","isStatic","width","parseInt","isNaN","sizes","push","quality","hash","getHash","imagesDir","hashDir","now","Date","has","get","dedupeResolver","set","Promise","resolve","files","readdir","file","maxAgeStr","expireAtSt","etag","extension","split","maxAge","Number","expireAt","contentType","fsPath","result","setResponseHeaders","pipe","unlink","upstreamBuffer","upstreamType","upstreamRes","fetch","ok","status","Buffer","from","arrayBuffer","resBuffers","mockRes","Writable","isStreamFinished","reject","on","write","chunk","isBuffer","_write","mockHeaders","writeHead","_status","_headers","Object","assign","getHeader","name","toLowerCase","getHeaders","getHeaderNames","keys","setHeader","value","removeHeader","_implicitHeader","connection","mockReq","Readable","_read","emit","method","getRequestHandler","parse","concat","err","Math","max","vector","animate","writeToCacheDir","sendResponse","optimizedBuffer","transformer","rotate","metaWidth","metadata","resize","webp","png","jpeg","toBuffer","console","warn","yellow","bold","orientation","operations","RIGHT_TOP","type","numRotations","BOTTOM_RIGHT","LEFT_BOTTOM","Error","error","delete","dir","buffer","mkdir","recursive","filename","writeFile","getFileNameWithExtension","urlWithoutQueryParams","fileNameWithExtension","pop","fileName","options","items","item","update","String","digest","replace","parseCacheControl","str","map","directive","key","trim","every","b","i","age","endsWith","slice","n","content","dimension","size","buf","resizeOperationOpts","height"],"mappings":"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"}